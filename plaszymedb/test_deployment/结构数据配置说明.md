# PlaszymeDB ç»“æ„æ•°æ®é…ç½®è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

æ‰€æœ‰è›‹ç™½è´¨3Dç»“æ„æ•°æ®ç°å·²ç»Ÿä¸€å­˜æ”¾åœ¨ `structure_data` æ–‡ä»¶å¤¹ä¸­ï¼š

```
C:\xampp\htdocs\plaszymedb\structure_data\
â”œâ”€â”€ predicted_xid/              # é¢„æµ‹ç»“æ„æ•°æ®
â”‚   â”œâ”€â”€ pdb/                    # 474ä¸ªPDBæ–‡ä»¶ (X0001.pdb - X0474.pdb)
â”‚   â”œâ”€â”€ json/                   # 474ä¸ªJSONå…ƒæ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ pred_metadata_XID.csv   # é¢„æµ‹æ•°æ®å…ƒæ•°æ®å’Œæ˜ å°„
â”‚   â”œâ”€â”€ PLZ_XID.csv            # PLZ_IDåˆ°XIDå®Œæ•´æ˜ å°„
â”‚   â””â”€â”€ PlaszymeDB_v1.csv      # å®Œæ•´æ•°æ®é›†
â”‚
â””â”€â”€ experimental_xid/           # å®éªŒç»“æ„æ•°æ®
    â”œâ”€â”€ pdb/                    # 33ä¸ªå®éªŒPDBæ–‡ä»¶ (XIDå‘½å)
    â”œâ”€â”€ json/                   # JSONå…ƒæ•°æ®æ–‡ä»¶
    â””â”€â”€ exp_metadata_XID.csv   # å®éªŒæ•°æ®å…ƒæ•°æ®å’Œæ˜ å°„
```

---

## ğŸ”‘ å…³é”®æ¦‚å¿µ

### PLZ_ID vs XID

- **PLZ_ID**: PlaszymeDBå†…éƒ¨å”¯ä¸€æ ‡è¯†ç¬¦ (10ä½å“ˆå¸Œï¼Œå¦‚ `866554aa77`)
  - æ•°æ®åº“ä¸­çš„ä¸»é”®
  - å‰ç«¯ç”¨äºæœç´¢å’Œæ˜¾ç¤º
  - URLå‚æ•°ä½¿ç”¨PLZ_ID

- **XID**: è›‹ç™½è´¨åºåˆ—æ ‡è¯†ç¬¦ (å¦‚ `X0001`, `X0002`)
  - PDBæ–‡ä»¶å‘½åä½¿ç”¨XID
  - ä¸å¤–éƒ¨æ•°æ®æºå¯¹åº”
  - ä¾¿äºäººç±»è¯†åˆ«

### æ˜ å°„å…³ç³»

APIä¼šè‡ªåŠ¨ä»metadataæ–‡ä»¶ä¸­è¯»å–PLZ_IDåˆ°XIDçš„æ˜ å°„ï¼š

- é¢„æµ‹æ•°æ®: `pred_metadata_XID.csv`
- å®éªŒæ•°æ®: `exp_metadata_XID.csv`

---

## ğŸ”§ å·²ä¿®æ”¹çš„æ–‡ä»¶

### 1. `api_protein_structure.php`

**ä¸»è¦ä¿®æ”¹:**

#### a) æ›´æ–°è·¯å¾„é…ç½®
```php
// æ—§è·¯å¾„ï¼ˆå·²åºŸå¼ƒï¼‰
$pdb_dir = $base_path . '/pdb_predicted/pdb/';

// æ–°è·¯å¾„
$pdb_dir = $base_path . '/structure_data/predicted_xid/pdb/';
```

#### b) æ·»åŠ PLZ_IDåˆ°XIDæ˜ å°„å‡½æ•°
```php
function loadPlzToXidMapping($csvPath) {
    // ä»CSVæ–‡ä»¶åŠ è½½æ˜ å°„å…³ç³»
    // ä½¿ç”¨é™æ€ç¼“å­˜æé«˜æ€§èƒ½
}
```

#### c) ä½¿ç”¨XIDè®¿é—®æ–‡ä»¶
```php
// åŠ è½½æ˜ å°„
$mapping = loadPlzToXidMapping($metadata_csv);
$xid = $mapping[$plz_id];

// ä½¿ç”¨XIDæ„å»ºæ–‡ä»¶è·¯å¾„
$pdb_file = $pdb_dir . $xid . '.pdb';
```

---

## ğŸ“Š Metadataæ–‡ä»¶æ ¼å¼

### é¢„æµ‹æ•°æ® (`pred_metadata_XID.csv`)

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| PLZ_ID | PlaszymeDB ID | 866554aa77 |
| protein_id | XIDæ ‡è¯†ç¬¦ | X0001 |
| pLDDT | é¢„æµ‹ç½®ä¿¡åº¦ | 97.7 |
| pTM | TM-score | 0.95 |
| pdb_path | PDBç›¸å¯¹è·¯å¾„ | pdb/X0001.pdb |
| json_path | JSONç›¸å¯¹è·¯å¾„ | json/X0001.json |

### å®éªŒæ•°æ® (`exp_metadata_XID.csv`)

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| PLZ_ID | PlaszymeDB ID | bd7ef0ab46 |
| protein_id | XIDæ ‡è¯†ç¬¦ | X0223 |
| pdb_id | PDBæ•°æ®åº“ID | 8AIR |
| structure_source | æ•°æ®æ¥æº | RCSB_PDB |
| structure_method | å®éªŒæ–¹æ³• | X-RAY DIFFRACTION |
| resolution | åˆ†è¾¨ç‡ | 1.08 Ã… |
| pdb_path | PDBç›¸å¯¹è·¯å¾„ | pdb/X0223.pdb |
| json_path | JSONç›¸å¯¹è·¯å¾„ | json/X0223.json |

---

## ğŸš€ APIä½¿ç”¨æ–¹æ³•

### 1. è·å–ç»“æ„ä¿¡æ¯

```
GET api_protein_structure.php?plz_id=866554aa77&type=predicted&action=info
```

**å‚æ•°:**
- `plz_id`: PLZ_IDæ ‡è¯†ç¬¦ (å¿…éœ€)
- `type`: æ•°æ®ç±»å‹ `predicted` æˆ– `experimental` (é»˜è®¤: `predicted`)
- `action`: æ“ä½œç±»å‹ `info` | `pdb` | `json` (é»˜è®¤: `info`)

**å“åº”ç¤ºä¾‹:**
```json
{
  "plz_id": "866554aa77",
  "xid": "X0001",
  "data_type": "predicted",
  "files": {
    "pdb_exists": true,
    "json_exists": true,
    "pdb_path": "api_protein_structure.php?plz_id=866554aa77&type=predicted&action=pdb",
    "json_path": "api_protein_structure.php?plz_id=866554aa77&type=predicted&action=json",
    "pdb_file_path": "C:/xampp/htdocs/plaszymedb/structure_data/predicted_xid/pdb/X0001.pdb",
    "json_file_path": "C:/xampp/htdocs/plaszymedb/structure_data/predicted_xid/pdb/X0001.json"
  },
  "enzyme_info": {
    "enzyme_name": "Enzyme 702",
    "ec_number": null,
    "pdb_ids": "7QJQ"
  }
}
```

### 2. ä¸‹è½½PDBæ–‡ä»¶

```
GET api_protein_structure.php?plz_id=866554aa77&type=predicted&action=pdb
```

ç›´æ¥è¿”å›PDBæ–‡ä»¶å†…å®¹ï¼Œæ–‡ä»¶åä¸º `X0001.pdb`

### 3. è·å–JSONå…ƒæ•°æ®

```
GET api_protein_structure.php?plz_id=866554aa77&type=predicted&action=json
```

è¿”å›ç»“æ„çš„JSONå…ƒæ•°æ®ï¼ˆå¦‚pLDDTã€pTMç­‰ï¼‰

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### å¿«é€Ÿæµ‹è¯•

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æµ‹è¯•é¡µé¢ï¼š
```
http://localhost/plaszymedb/test_structure_api.php
```

è¯¥æµ‹è¯•é¡µé¢ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š
- âœ… ç›®å½•ç»“æ„å®Œæ•´æ€§
- âœ… Metadataæ–‡ä»¶å­˜åœ¨æ€§
- âœ… PLZ_IDåˆ°XIDæ˜ å°„
- âœ… APIè°ƒç”¨åŠŸèƒ½
- âœ… PDBæ–‡ä»¶å¯è®¿é—®æ€§

### æ‰‹åŠ¨æµ‹è¯•

#### æµ‹è¯•é¢„æµ‹ç»“æ„
```bash
# è·å–ä¿¡æ¯
curl "http://localhost/plaszymedb/api_protein_structure.php?plz_id=866554aa77&type=predicted&action=info"

# ä¸‹è½½PDB
curl "http://localhost/plaszymedb/api_protein_structure.php?plz_id=866554aa77&type=predicted&action=pdb" -o test.pdb
```

#### æµ‹è¯•å®éªŒç»“æ„
```bash
# è·å–ä¿¡æ¯
curl "http://localhost/plaszymedb/api_protein_structure.php?plz_id=bd7ef0ab46&type=experimental&action=info"

# ä¸‹è½½PDB
curl "http://localhost/plaszymedb/api_protein_structure.php?plz_id=bd7ef0ab46&type=experimental&action=pdb" -o test_exp.pdb
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ˜ å°„ç¼“å­˜

`loadPlzToXidMapping()` å‡½æ•°ä½¿ç”¨é™æ€ç¼“å­˜ï¼š
```php
static $cache = [];
```

åŒä¸€è¯·æ±‚ä¸­å¤šæ¬¡è°ƒç”¨ä¸ä¼šé‡å¤è¯»å–CSVæ–‡ä»¶ï¼Œæé«˜æ€§èƒ½ã€‚

### æ–‡ä»¶è®¿é—®

- PDBæ–‡ä»¶ç›´æ¥ä½¿ç”¨ `readfile()` æµå¼ä¼ è¾“
- ä¸ä¼šå°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜
- é€‚åˆå¤§å‹PDBæ–‡ä»¶

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¦ä½¿ç”¨XIDè€Œä¸æ˜¯PLZ_IDå‘½åæ–‡ä»¶ï¼Ÿ

**A:** 
- XIDæ›´ç®€çŸ­æ˜“è¯» (`X0001` vs `866554aa77`)
- ä¸å¤–éƒ¨æ•°æ®æºä¿æŒä¸€è‡´
- ä¾¿äºæ‰‹åŠ¨ç®¡ç†å’Œæ£€æŸ¥æ–‡ä»¶

### Q2: å¦‚æœmetadataæ–‡ä»¶ç¼ºå¤±ä¼šæ€æ ·ï¼Ÿ

**A:** APIä¼šè¿”å›é”™è¯¯ï¼š
```json
{
  "error": true,
  "message": "æœªæ‰¾åˆ°PLZ_ID 'xxx' å¯¹åº”çš„ç»“æ„æ•°æ®"
}
```

### Q3: é¢„æµ‹ç»“æ„å’Œå®éªŒç»“æ„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A:**
- **é¢„æµ‹ç»“æ„**: AlphaFoldç­‰å·¥å…·é¢„æµ‹ï¼ŒåŒ…å«pLDDTå’ŒpTMæŒ‡æ ‡
- **å®éªŒç»“æ„**: X-ray/NMRç­‰å®éªŒè·å¾—ï¼ŒåŒ…å«åˆ†è¾¨ç‡å’ŒPDB ID

### Q4: å‰ç«¯å¦‚ä½•é€‰æ‹©ä½¿ç”¨å“ªç§ç±»å‹çš„ç»“æ„ï¼Ÿ

**A:** å‰ç«¯æ ¹æ®å¯ç”¨æ€§è‡ªåŠ¨é€‰æ‹©ï¼š
1. ä¼˜å…ˆä½¿ç”¨å®éªŒç»“æ„ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
2. å¦åˆ™ä½¿ç”¨é¢„æµ‹ç»“æ„
3. ç”¨æˆ·å¯æ‰‹åŠ¨åˆ‡æ¢

---

## ğŸ”„ æ•°æ®æ›´æ–°æµç¨‹

å¦‚æœéœ€è¦æ·»åŠ æ–°çš„ç»“æ„æ•°æ®ï¼š

1. **æ·»åŠ PDBæ–‡ä»¶**
   ```bash
   # é¢„æµ‹ç»“æ„
   structure_data/predicted_xid/pdb/X0475.pdb
   
   # å®éªŒç»“æ„
   structure_data/experimental_xid/pdb/X0475.pdb
   ```

2. **æ›´æ–°metadata CSV**
   - åœ¨å¯¹åº”çš„CSVæ–‡ä»¶ä¸­æ·»åŠ æ–°è¡Œ
   - åŒ…å«PLZ_IDã€XIDå’Œå…¶ä»–å…ƒæ•°æ®

3. **æ¸…é™¤ç¼“å­˜**
   - é‡å¯PHPè¿›ç¨‹æˆ–é‡æ–°åŠ è½½é¡µé¢
   - é™æ€ç¼“å­˜ä¼šè‡ªåŠ¨åˆ·æ–°

---

## ğŸ“ ä»£ç ç¤ºä¾‹

### å‰ç«¯JavaScriptè°ƒç”¨

```javascript
// åŠ è½½é¢„æµ‹ç»“æ„
async function loadStructure(plzId) {
    const apiUrl = `api_protein_structure.php?plz_id=${plzId}&type=predicted&action=pdb`;
    const response = await fetch(apiUrl);
    const pdbText = await response.text();
    
    // ä½¿ç”¨Mol*åŠ è½½ç»“æ„
    // ... (è§protein_viewer_optimized.js)
}

// è·å–ç»“æ„ä¿¡æ¯
async function getStructureInfo(plzId, type = 'predicted') {
    const apiUrl = `api_protein_structure.php?plz_id=${plzId}&type=${type}&action=info`;
    const response = await fetch(apiUrl);
    const info = await response.json();
    
    console.log('XID:', info.xid);
    console.log('PDB exists:', info.files.pdb_exists);
}
```

### PHPåç«¯è°ƒç”¨

```php
// è·å–æŸä¸ªé…¶çš„ç»“æ„ä¿¡æ¯
$plz_id = '866554aa77';
$url = "http://localhost/plaszymedb/api_protein_structure.php?plz_id={$plz_id}&type=predicted&action=info";
$response = file_get_contents($url);
$data = json_decode($response, true);

if ($data['files']['pdb_exists']) {
    echo "æ‰¾åˆ°ç»“æ„æ–‡ä»¶: " . $data['xid'];
}
```

---

## ğŸ¯ æ€»ç»“

### ä¿®æ”¹å‰åå¯¹æ¯”

| é¡¹ç›® | ä¿®æ”¹å‰ | ä¿®æ”¹å |
|------|--------|--------|
| ç›®å½•è·¯å¾„ | `pdb_predicted/` | `structure_data/predicted_xid/` |
| æ–‡ä»¶å‘½å | PLZ_ID | XID |
| æ˜ å°„æœºåˆ¶ | æ—  | CSV metadataæ–‡ä»¶ |
| ç¼“å­˜ç­–ç•¥ | æ—  | é™æ€ç¼“å­˜ |
| é”™è¯¯ä¿¡æ¯ | ç®€å• | è¯¦ç»†ï¼ˆåŒ…å«PLZ_IDã€XIDã€è·¯å¾„ï¼‰ |

### ä¸»è¦ä¼˜åŠ¿

âœ… **ç»Ÿä¸€ç®¡ç†**: æ‰€æœ‰ç»“æ„æ•°æ®é›†ä¸­åœ¨ `structure_data` æ–‡ä»¶å¤¹  
âœ… **æ¸…æ™°å‘½å**: ä½¿ç”¨XIDä½¿æ–‡ä»¶æ›´æ˜“è¯†åˆ«  
âœ… **çµæ´»æ˜ å°„**: æ”¯æŒPLZ_IDåˆ°XIDçš„è‡ªåŠ¨è½¬æ¢  
âœ… **é«˜æ€§èƒ½**: æ˜ å°„ç¼“å­˜å‡å°‘é‡å¤è¯»å–  
âœ… **æ˜“ç»´æŠ¤**: é€šè¿‡CSVæ–‡ä»¶ç®¡ç†æ˜ å°„å…³ç³»  
âœ… **å‘åå…¼å®¹**: APIæ¥å£ä¿æŒä¸å˜ï¼Œåªéœ€ä¼ å…¥PLZ_ID

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç›®å½•æƒé™æ˜¯å¦æ­£ç¡®
2. metadata CSVæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
3. PDBæ–‡ä»¶æ˜¯å¦å­˜åœ¨
4. è®¿é—® `test_structure_api.php` æŸ¥çœ‹è¯¦ç»†è¯Šæ–­ä¿¡æ¯

---

*æœ€åæ›´æ–°: 2025-10-08*

