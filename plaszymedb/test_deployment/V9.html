<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1440, initial-scale=1.0">
    <title>PlaszymeDB - Plastic-Degrading Enzyme Database</title>
    
    <!-- Mol* Library -->
    <script src="https://cdn.jsdelivr.net/npm/molstar@latest/build/viewer/molstar.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/molstar@latest/build/viewer/molstar.css">
    
    <!-- 蛋白质3D结构查看器 (优化版) -->
    <script src="protein_viewer_optimized.js"></script>
    
    
    <style>
        /* 字体定义 */
        @font-face {
            font-family: 'Source Sans Pro';
            src: url('fonts/SourceSansPro-Light.woff2') format('woff2'),
                 url('fonts/SourceSansPro-Light.woff') format('woff');
            font-weight: 300;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Source Sans Pro';
            src: url('fonts/SourceSansPro-Regular.woff2') format('woff2'),
                 url('fonts/SourceSansPro-Regular.woff') format('woff');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Source Sans Pro';
            src: url('fonts/SourceSansPro-Medium.woff2') format('woff2'),
                 url('fonts/SourceSansPro-Medium.woff') format('woff');
            font-weight: 500;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Source Sans Pro';
            src: url('fonts/SourceSansPro-SemiBold.woff2') format('woff2'),
                 url('fonts/SourceSansPro-SemiBold.woff') format('woff');
            font-weight: 600;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Source Sans Pro';
            src: url('fonts/SourceSansPro-Bold.woff2') format('woff2'),
                 url('fonts/SourceSansPro-Bold.woff') format('woff');
            font-weight: 700;
            font-style: normal;
            font-display: swap;
        }
        
        /* CSS 变量定义 */
        :root {
            /* 浅色模式颜色 */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #f0f2f5;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.05);
            --shadow-color-hover: rgba(0, 0, 0, 0.1);
            --brand-primary: #005eb8;
            --brand-secondary: #0078d4;
            --hover-bg: rgba(0, 94, 184, 0.1);
        }
        
        /* 深色模式颜色 */
        body.dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3a3a3a;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --text-tertiary: #808080;
            --border-color: #404040;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --shadow-color-hover: rgba(0, 0, 0, 0.5);
            --brand-primary: #4da3ff;
            --brand-secondary: #66b3ff;
            --hover-bg: rgba(77, 163, 255, 0.1);
        }
        
        /* 深色模式下主题切换按钮图标切换 */
        body.dark-mode .theme-toggle .sun-icon {
            display: none;
        }
        
        body.dark-mode .theme-toggle .moon-icon {
            display: block;
        }
        
        body.dark-mode .theme-icon {
            color: #e0e0e0;
        }
        
        /* 全局样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* 导航栏 - 参考XJTLU风格 */
        .header {
            background-color: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px var(--shadow-color);
            transition: all 0.3s ease;
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #005eb8, #0078d4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }
        
        .logo-text {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--brand-primary);
        }
        
        .nav-menu {
            display: flex;
            gap: 2rem;
            list-style: none;
        }
        
        .nav-menu a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 0;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .nav-menu a:hover,
        .nav-menu a.active {
            color: var(--brand-primary);
            border-bottom-color: var(--brand-primary);
        }
        
        /* 主题切换按钮 */
        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
            margin-left: 2rem;
        }
        
        .theme-toggle:hover {
            background-color: var(--hover-bg);
        }
        
        .theme-icon {
            width: 24px;
            height: 24px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        .theme-toggle .sun-icon {
            display: block;
        }
        
        .theme-toggle .moon-icon {
            display: none;
        }
        
        /* 主要内容区域 */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }
        
        /* Hero区域 - 简洁风格 */
        .hero-section {
            text-align: center;
            margin-bottom: 4rem;
        }
        
        .hero-title {
            font-size: 2.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .hero-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-weight: 300;
        }
        
        /* 搜索框 */
        .search-container {
            max-width: 800px;
            margin: 0 auto 3rem;
            position: relative;
        }
        
        .search-box {
            display: flex;
            background: var(--bg-primary);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px var(--shadow-color-hover);
            border: 1px solid var(--border-color);
        }
        
        .search-input {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            font-size: 1rem;
            outline: none;
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .search-button {
            padding: 1rem 2rem;
            background: var(--brand-primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .search-button:hover {
            background: var(--brand-secondary);
        }
        
        /* 功能卡片网格 */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-bottom: 4rem;
        }
        
        .feature-card {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 2px 8px var(--shadow-color);
            border: 1px solid var(--border-color);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow-color-hover);
        }
        
        .feature-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            background: #e8f0fe;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }
        
        .feature-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .feature-description {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.6;
            font-weight: 300;
        }
        
        /* 统计数据部分 */
        .stats-section {
            background: white;
            border-radius: 8px;
            padding: 3rem;
            margin-bottom: 4rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .stats-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .stats-title {
            font-size: 2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .stats-subtitle {
            color: #666;
            font-weight: 300;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            color: #005eb8;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.95rem;
        }
        
        /* 数据可视化部分 */
        .visualization-section {
            margin-bottom: 4rem;
        }
        
        .viz-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .viz-grid {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .viz-card {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .viz-title {
            font-size: 1.8rem;
            font-weight: 500;
            color: #333;
            margin: 0;
            text-align: center;
            width: 100%;
        }
        
        .chart-placeholder {
            width: 100%;
            height: 400px;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .chart-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* 按钮样式 */
        .btn {
            display: inline-block;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
        }
        
        .btn-primary {
            background: #005eb8;
            color: white;
        }
        
        .btn-primary:hover {
            background: #004494;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: white;
            color: #005eb8;
            border: 2px solid #005eb8;
        }
        
        .btn-secondary:hover {
            background: #005eb8;
            color: white;
        }
        
        /* 页脚 */
        .footer {
            background: #333;
            color: white;
            padding: 3rem 0 2rem;
            margin-top: 4rem;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 3rem;
        }
        
        .footer-section h4 {
            margin-bottom: 1rem;
            font-weight: 500;
        }
        
        .footer-section p,
        .footer-section a {
            color: #ccc;
            text-decoration: none;
            line-height: 1.8;
            font-size: 0.9rem;
        }
        
        .footer-section a:hover {
            color: white;
        }
        
        .footer-bottom {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #555;
            color: #999;
            font-size: 0.85rem;
        }
        
        /* 浏览页面 - 列表视图 */
        .browse-page {
            display: none;
        }
        
        .browse-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .browse-title {
            font-size: 2rem;
            font-weight: 300;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .browse-subtitle {
            color: #666;
        }
        
        /* 搜索和筛选区域 */
        .browse-search-section {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }
        
        .browse-search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .browse-search-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95rem;
            outline: none;
        }
        
        .browse-search-input:focus {
            border-color: #005eb8;
        }
        
        .filter-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        
        .filter-item {
            display: flex;
            flex-direction: column;
        }
        
        .filter-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .filter-select {
            padding: 0.5rem;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background: white;
            font-size: 0.9rem;
        }
        
        /* 结果表格容器 */
        .results-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .results-header {
            padding: 1.5rem;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .results-info {
            color: #666;
            font-size: 0.95rem;
        }
        
        .export-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            border: 2px solid #4a90e2;
            background: white;
            color: #4a90e2;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .btn-small:hover {
            background: #4a90e2;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(74, 144, 226, 0.3);
        }
        
        .btn-small:active {
            transform: translateY(0);
        }
        
        .btn-small:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* 表格样式 */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 500;
            color: #666;
            border-bottom: 2px solid #e0e0e0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        td {
            padding: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .plastic-tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: #e8f0fe;
            color: #005eb8;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .view-link {
            color: #005eb8;
            text-decoration: none;
            font-weight: 500;
            padding: 0.25rem 0.75rem;
            background: #e8f0fe;
            border-radius: 4px;
            display: inline-block;
            transition: all 0.3s;
        }
        
        .view-link:hover {
            background: #005eb8;
            color: white;
        }
        
        /* 新详情页面样式 */
        .detail-page {
            display: none;
            background-color: #f8f9fa;
        }
        
        .detail-main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .breadcrumb {
            margin-bottom: 1.5rem;
            color: #666;
            font-size: 0.9rem;
        }
        
        .breadcrumb a {
            color: #005eb8;
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        /* 页面标题区域 - 简化设计 */
        .page-header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 2rem;
            border-left: 4px solid #005eb8;
        }
        
        .header-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .header-subtitle {
            color: #666;
            font-size: 1rem;
            font-weight: 400;
        }
        
        /* 基本信息区域 - 弱化展示 */
        .basic-info-strip {
            background: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            border: 1px solid #f0f0f0;
        }
        
        .basic-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .basic-info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .basic-info-label {
            font-size: 0.85rem;
            color: #888;
            font-weight: 500;
            min-width: 80px;
        }
        
        .basic-info-value {
            font-size: 0.9rem;
            color: #555;
        }
        
        .plastic-tag-small {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            background: #e8f0fe;
            color: #005eb8;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        /* 结构信息区域 - 突出展示 */
        .structure-section {
            margin-bottom: 3rem;
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .section-subtitle {
            color: #666;
            font-size: 1.1rem;
            font-weight: 300;
        }
        
        .structure-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            align-items: start; /* 确保两个卡片顶部对齐 */
        }
        
        .structure-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 1px solid rgba(0,94,184,0.1);
            display: flex;
            flex-direction: column; /* 使用 flex 布局确保内部元素对齐 */
        }
        
        .structure-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
        }
        
        .structure-card-header {
            text-align: center;
            margin-bottom: 1.5rem;
            min-height: 70px; /* 固定高度确保两侧对齐 */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .structure-card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .structure-card-subtitle {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .structure-viewer {
            height: 400px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            border: 2px dashed #dee2e6;
            position: relative;
            overflow: hidden;
        }
        
        .structure-viewer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(0,94,184,0.05) 50%, transparent 70%);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .structure-placeholder {
            font-size: 4rem;
            color: #005eb8;
            opacity: 0.6;
            margin-bottom: 1rem;
            z-index: 1;
        }
        
        .structure-label {
            font-size: 1rem;
            color: #666;
            text-align: center;
            z-index: 1;
        }
        
        .structure-meta {
            font-size: 0.9rem;
            color: #888;
            margin-top: 0.5rem;
            z-index: 1;
        }
        
        .structure-controls {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 0.5rem 1rem;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            color: #666;
        }
        
        .control-btn:hover {
            background: #005eb8;
            color: white;
            border-color: #005eb8;
        }
        
        /* 其他部分的样式 */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .content-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
        }
        
        .content-section.full-width {
            grid-column: span 2;
        }
        
        .content-section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #f0f0f0;
        }
        
        /* 序列展示 */
        .sequence-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .sequence-info {
            color: #666;
            font-size: 0.9rem;
        }
        
        .download-btn {
            padding: 0.5rem 1rem;
            background: #005eb8;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        
        .download-btn:hover {
            background: #004494;
        }
        
        .sequence-box {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            line-height: 1.8;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
            word-break: break-all;
            border: 1px solid #e9ecef;
        }
        
        /* ABOUT页面样式 */
        .about-page {
            display: none;
            background-color: #f8f9fa;
        }
        
        .about-main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .about-header {
            background: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 3rem;
        }
        
        .about-logo {
            flex-shrink: 0;
        }
        
        .about-logo-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #005eb8, #0078d4, #9b59b6);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            box-shadow: 0 4px 16px rgba(0,94,184,0.3);
        }
        
        .about-content {
            flex: 1;
        }
        
        .about-title {
            font-size: 2.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }
        
        .about-description {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .about-sections {
            display: grid;
            gap: 2rem;
        }
        
        .about-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .about-section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .about-text {
            color: #555;
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }
        
        .about-text:last-child {
            margin-bottom: 0;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 1.5rem 0;
        }
        
        .feature-list li {
            padding: 0.75rem 0;
            border-bottom: 1px solid #f8f9fa;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-icon {
            color: #005eb8;
            font-size: 1.1rem;
            margin-top: 0.1rem;
            flex-shrink: 0;
        }
        
        .feature-text {
            color: #555;
            line-height: 1.6;
        }
        
        .feature-link {
            color: #005eb8;
            text-decoration: none;
            font-weight: 500;
        }
        
        .feature-link:hover {
            text-decoration: underline;
        }
        
        .citation-box {
            background: #f8f9fa;
            border-left: 4px solid #005eb8;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        .citation-text {
            font-style: italic;
            color: #555;
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }
        
        .citation-note {
            font-size: 0.9rem;
            color: #888;
        }
        
        .contact-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1.5rem;
        }
        
        .contact-item {
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #005eb8;
        }
        
        .contact-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .contact-value {
            color: #666;
        }
        
        .contact-link {
            color: #005eb8;
            text-decoration: none;
        }
        
        .contact-link:hover {
            text-decoration: underline;
        }
        .db-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }
        
        .db-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            text-decoration: none;
            color: #333;
            transition: all 0.3s;
        }
        
        .db-link:hover {
            background: #005eb8;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,94,184,0.3);
        }
        
        .db-icon {
            font-size: 1.2rem;
            color: #005eb8;
        }
        
        .db-link:hover .db-icon {
            color: white;
        }
        
        .db-text {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* 参考文献 */
        .references-list {
            list-style: none;
            padding: 0;
        }
        
        .references-list li {
            padding: 1rem 0;
            border-bottom: 1px solid #f0f0f0;
            color: #666;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .references-list li:last-child {
            border-bottom: none;
        }
        
        /* 操作按钮 */
        .action-bar {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            margin-top: 2rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        /* 更新时间线 */
        .timeline {
            position: relative;
            padding: 2rem 0;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e0e0e0;
        }
        
        .timeline-item {
            position: relative;
            padding-left: 60px;
            margin-bottom: 2rem;
        }
        
        .timeline-dot {
            position: absolute;
            left: 11px;
            top: 5px;
            width: 20px;
            height: 20px;
            background: #005eb8;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .timeline-content {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .timeline-date {
            font-weight: 500;
            color: #005eb8;
            margin-bottom: 0.5rem;
        }
        
        .timeline-title {
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .timeline-desc {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* PHYLOGENY页面样式 - iTOL项目列表风格 */
        .phylogeny-page {
            display: none;
            background-color: #f8f9fa;
        }

        /* iTOL嵌入式iframe容器样式 */
        .itol-embedded-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-top: 2rem;
        }

        .itol-embedded-header {
            background: linear-gradient(135deg, #005eb8, #0078d4);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .itol-embedded-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .itol-embedded-title span:first-child {
            font-size: 1.5rem;
        }


        .itol-embedded-content {
            position: relative;
            width: 100%;
            height: 600px;
            background: #f8f9fa;
            /* 防止滚动事件冒泡到父页面 */
            overflow: hidden;
        }

        .itol-embedded-content iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            /* 确保iframe内的滚动不影响父页面 */
            pointer-events: auto;
        }

        .iframe-fallback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #666;
            padding: 2rem;
        }

        .iframe-fallback h3 {
            color: #e74c3c;
            margin-bottom: 1rem;
        }

        .iframe-fallback a {
            color: #005eb8;
            text-decoration: none;
            font-weight: 500;
        }

        .iframe-fallback a:hover {
            text-decoration: underline;
        }

        .itol-embedded-footer {
            background: #f8f9fa;
            padding: 1rem 2rem;
            border-top: 1px solid #e0e0e0;
        }

        .itol-footer-info p {
            margin: 0;
            font-size: 0.9rem;
            color: #666;
            text-align: center;
        }

        .itol-footer-info a {
            color: #005eb8;
            text-decoration: none;
        }

        .itol-footer-info a:hover {
            text-decoration: underline;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .itol-embedded-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .itol-embedded-content {
                height: 500px;
            }

            .itol-footer-info p {
                font-size: 0.8rem;
            }
        }
        
        .phylogeny-main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .phylogeny-header {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .phylogeny-title {
            font-size: 2.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .phylogeny-subtitle {
            color: #666;
            font-size: 1.1rem;
            font-weight: 300;
            margin-bottom: 1.5rem;
        }
        
        .phylogeny-description {
            color: #555;
            font-size: 0.95rem;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* 项目列表容器 */
        .tree-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            overflow: hidden;
            position: relative;
        }
        
        .tree-header {
            padding: 1.5rem 2rem;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tree-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tree-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .tree-search {
            padding: 0.5rem 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
            width: 200px;
        }
        
        .tree-search:focus {
            outline: none;
            border-color: #005eb8;
        }
        
        .tree-btn {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            border: 1px solid #e0e0e0;
            background: white;
            color: #666;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tree-btn:hover {
            background: #005eb8;
            color: white;
            border-color: #005eb8;
        }
        
        /* 项目表格样式 */
        .projects-table-container {
            overflow-x: auto;
        }
        
        .projects-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .projects-table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .projects-table td {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
        }
        
        .project-row:hover {
            background: #f8f9fa;
        }
        
        .project-link {
            color: #005eb8;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .project-link:hover {
            text-decoration: underline;
        }
        
        .text-center {
            text-align: center;
        }
        
        /* 数据集颜色指示器 */
        .datasets-cell {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .dataset-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            display: inline-block;
        }
        
        .dataset-plus {
            font-size: 0.8rem;
            color: #666;
            font-weight: 600;
            margin-left: 0.25rem;
        }
        
        /* 查看按钮 */
        .view-btn {
            padding: 0.4rem 1rem;
            background: #005eb8;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .view-btn:hover {
            background: #004494;
            transform: translateY(-1px);
        }
        
        /* 分页控件 */
        .pagination-container {
            padding: 1rem 2rem;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pagination-info {
            color: #666;
            font-size: 0.9rem;
        }
        
        .pagination-controls {
            display: flex;
            gap: 0.25rem;
        }
        
        .pagination-btn {
            padding: 0.4rem 0.8rem;
            border: 1px solid #e0e0e0;
            background: white;
            color: #666;
            cursor: pointer;
            font-size: 0.85rem;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: #f8f9fa;
        }
        
        .pagination-btn.active {
            background: #005eb8;
            color: white;
            border-color: #005eb8;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 3px solid #005eb8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* 树图信息面板 */
        .tree-info {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-top: 2rem;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .info-section {
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #005eb8;
        }
        
        .info-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }
        
        .info-content {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .info-list {
            list-style: none;
            padding: 0;
        }
        
        .info-list li {
            padding: 0.25rem 0;
            display: flex;
            justify-content: space-between;
        }
        
        .info-list .label {
            font-weight: 500;
            color: #555;
        }
        
        .info-list .value {
            color: #005eb8;
            font-weight: 600;
        }
        
        /* iTOL iframe 样式 */
        .itol-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }

        .itol-modal-content {
            position: relative;
            width: 95%;
            height: 90%;
            max-width: 1400px;
            margin: 2.5% auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .itol-modal-header {
            background: #005eb8;
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 12px 12px 0 0;
        }

        .itol-modal-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }

        .itol-modal-controls {
            display: flex;
            gap: 0.5rem;
        }

        .itol-control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .itol-control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .itol-close-btn {
            background: #e74c3c;
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .itol-close-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .itol-iframe-container {
            flex: 1;
            position: relative;
            background: #f8f9fa;
        }

        .itol-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        .itol-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            color: #666;
        }

        .itol-loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #005eb8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* 树列表中的启动iframe按钮样式 */
        .view-btn.itol-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .view-btn.itol-btn:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .view-btn.itol-btn:before {
            content: "🌳";
            margin-right: 0.5rem;
        }

        /* 新的内嵌iframe容器样式 */
        .itol-iframe-container {
            display: none;
            position: fixed;
            top: 60px;
            right: 20px;
            width: 70%;
            height: 80vh;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            overflow: hidden;
            animation: slideInFromRight 0.3s ease;
        }

        @keyframes slideInFromRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .iframe-header {
            background: #005eb8;
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 12px 12px 0 0;
        }

        .iframe-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .iframe-close-btn {
            background: #e74c3c;
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .iframe-close-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .iframe-content {
            flex: 1;
            height: calc(100% - 120px);
            position: relative;
        }

        .iframe-content iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        .iframe-footer {
            background: #f8f9fa;
            padding: 0.8rem 1.5rem;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            font-size: 0.85rem;
            color: #666;
        }

        .iframe-footer a {
            color: #005eb8;
            text-decoration: none;
        }

        .iframe-footer a:hover {
            text-decoration: underline;
        }

        /* 响应式调整 */
        @media (max-width: 1200px) {
            .itol-iframe-container {
                width: 85%;
                right: 10px;
            }
        }

        @media (max-width: 768px) {
            .itol-iframe-container {
                width: 95%;
                height: 85vh;
                top: 40px;
                right: 2.5%;
            }
        }
        
        /* STATISTICS页面样式 */
        .statistics-page {
            display: none;
            background-color: #f8f9fa;
            min-height: 100vh;
            padding: 2rem 0;
        }
        
        .statistics-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .statistics-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 3rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid #005eb8;
        }
        
        .statistics-images {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }
        
        .stat-image-wrapper {
            width: 100%;
            max-width: 900px;
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-image-wrapper:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
        }
        
        .stat-image-wrapper img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .statistics-container {
                padding: 1rem;
            }
            
            .statistics-title {
                font-size: 2rem;
                margin-bottom: 2rem;
            }
            
            .stat-image-wrapper {
                padding: 1rem;
            }
        }
        
        /* 通知消息动画 */
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        
        /* BLAST页面样式 */
        .blast-page {
            display: none;
            background-color: #f8f9fa;
        }
        
        .blast-main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .blast-header {
            background: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .blast-title {
            font-size: 2.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }
        
        .blast-subtitle {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            font-weight: 300;
        }
        
        .blast-description {
            color: #555;
            font-size: 1rem;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* 搜索卡片 */
        .blast-search-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .blast-search-header {
            background: linear-gradient(135deg, #005eb8, #0078d4);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .blast-search-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .blast-search-description {
            opacity: 0.9;
            font-size: 1rem;
        }
        
        .blast-search-form {
            padding: 2rem;
        }
        
        /* 输入区域 */
        .blast-input-section {
            margin-bottom: 2rem;
        }
        
        .blast-input-label {
            display: block;
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .blast-sequence-textarea {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
            transition: border-color 0.3s;
            background: #f8f9fa;
        }
        
        .blast-sequence-textarea:focus {
            outline: none;
            border-color: #005eb8;
            box-shadow: 0 0 0 3px rgba(0,94,184,0.1);
            background: white;
        }
        
        .blast-input-help {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.5rem;
        }
        
        .blast-example-btn {
            color: #005eb8;
            background: none;
            border: none;
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.85rem;
        }
        
        .blast-example-btn:hover {
            color: #004494;
        }
        
        /* 参数设置 */
        .blast-parameters-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .blast-parameters-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
        }
        
        .blast-param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
        }
        
        .blast-param-group {
            display: flex;
            flex-direction: column;
        }
        
        .blast-param-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #555;
            margin-bottom: 0.25rem;
        }
        
        .blast-param-select {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
            background: white;
        }
        
        .blast-param-help {
            font-size: 0.75rem;
            color: #888;
            margin-top: 0.25rem;
        }
        
        /* 提交按钮 */
        .blast-submit-section {
            text-align: center;
        }
        
        .blast-submit-btn {
            background: linear-gradient(135deg, #005eb8, #0078d4);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,94,184,0.3);
        }
        
        .blast-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,94,184,0.4);
        }
        
        .blast-submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* 加载状态 */
        .blast-loading-container {
            text-align: center;
            padding: 3rem 2rem;
        }
        
        .blast-loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #005eb8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        .blast-loading-text {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        .blast-loading-details {
            color: #999;
            font-size: 0.9rem;
        }
        
        /* 结果区域 */
        .blast-results-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .blast-results-header {
            background: #f8f9fa;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .blast-results-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }
        
        .blast-results-info {
            color: #666;
            font-size: 0.9rem;
        }
        
        .blast-results-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .blast-action-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .blast-action-btn:hover {
            background: #f8f9fa;
        }
        
        .blast-action-btn.blast-action-primary {
            background: #005eb8;
            color: white;
            border-color: #005eb8;
        }
        
        .blast-action-btn.blast-action-primary:hover {
            background: #004494;
        }
        
        /* 结果表格 */
        .blast-results-table-container {
            overflow-x: auto;
        }
        
        .blast-results-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        .blast-results-table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .blast-results-table td {
            padding: 1rem;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: top;
        }
        
        .blast-result-row:hover {
            background: #f8f9fa;
        }
        
        .blast-enzyme-link {
            color: #005eb8;
            text-decoration: none;
            font-weight: 600;
        }
        
        .blast-enzyme-link:hover {
            text-decoration: underline;
        }
        
        .blast-organism-name {
            font-style: italic;
            color: #666;
        }
        
        .blast-score-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .blast-score-excellent {
            background: #c8e6c9;
            color: #388e3c;
        }
        
        .blast-score-good {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .blast-score-fair {
            background: #ffebee;
            color: #d32f2f;
        }
        
        .blast-alignment-preview {
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            background: #f5f5f5;
            padding: 0.5rem;
            border-radius: 4px;
            margin-top: 0.5rem;
            line-height: 1.2;
            overflow-x: auto;
        }
        
        .blast-view-btn {
            padding: 0.25rem 0.75rem;
            background: #005eb8;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .blast-view-btn:hover {
            background: #004494;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .blast-main-container {
                padding: 1rem;
            }
            
            .blast-search-form, .blast-search-header {
                padding: 1.5rem;
            }
            
            .blast-param-grid {
                grid-template-columns: 1fr;
            }
            
            .blast-results-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .blast-results-actions {
                justify-content: center;
                flex-wrap: wrap;
            }
        }
        @media (max-width: 768px) {
            .structure-grid {
                grid-template-columns: 1fr;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .basic-info-grid {
                grid-template-columns: 1fr;
            }
            
            .detail-main-container {
                padding: 1rem;
            }
        }
        
        /* 隐藏页面 */
        .hidden {
            display: none;
        }
        
        /* 加载动画 */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-container {
            text-align: center;
            padding: 100px 20px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        .error-container {
            text-align: center;
            padding: 100px 20px;
        }
        
        .error-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .error-container h3 {
            color: #dc3545;
            margin-bottom: 10px;
        }
        
        .error-container p {
            color: #666;
            margin-bottom: 20px;
        }
        
        /* ==================== 主题切换按钮样式 ==================== */
        .theme-toggle {
            position: relative;
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            margin-left: 20px;
        }
        
        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .theme-icon {
            width: 20px;
            height: 20px;
            position: absolute;
            transition: all 0.3s ease;
        }
        
        .sun-icon {
            opacity: 1;
            transform: rotate(0deg);
        }
        
        .moon-icon {
            opacity: 0;
            transform: rotate(180deg);
        }
        
        /* 深色模式下图标切换 */
        body.dark-mode .sun-icon {
            opacity: 0;
            transform: rotate(180deg);
        }
        
        body.dark-mode .moon-icon {
            opacity: 1;
            transform: rotate(0deg);
        }
        
        /* ==================== 深色模式样式 ==================== */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        
        /* 导航栏深色模式 */
        body.dark-mode .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        body.dark-mode .logo-text {
            color: #fff;
        }
        
        body.dark-mode .nav-menu a {
            color: rgba(255, 255, 255, 0.9);
        }
        
        body.dark-mode .nav-menu a:hover,
        body.dark-mode .nav-menu a.active {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* 主页深色模式 */
        body.dark-mode .hero {
            background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%);
        }
        
        body.dark-mode .hero-title {
            color: #fff;
        }
        
        body.dark-mode .hero-subtitle {
            color: rgba(255, 255, 255, 0.8);
        }
        
        body.dark-mode .search-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .search-input {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .search-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        body.dark-mode .search-button {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
        }
        
        body.dark-mode .search-button:hover {
            background: linear-gradient(135deg, #357abd 0%, #2868a8 100%);
        }
        
        body.dark-mode .feature-card {
            background: #2a2a2a;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .feature-card:hover {
            background: #333;
            border-color: rgba(74, 144, 226, 0.5);
            box-shadow: 0 8px 30px rgba(74, 144, 226, 0.2);
        }
        
        body.dark-mode .feature-icon {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
        }
        
        body.dark-mode .feature-title {
            color: #fff;
        }
        
        body.dark-mode .feature-description {
            color: rgba(255, 255, 255, 0.7);
        }
        
        body.dark-mode .stats-item {
            background: #2a2a2a;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .stats-number {
            color: #4a90e2;
        }
        
        body.dark-mode .stats-label {
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Browse页面深色模式 */
        body.dark-mode .filter-section {
            background: #2a2a2a;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .filter-title {
            color: #fff;
        }
        
        body.dark-mode .filter-tags {
            background: #1a1a1a;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .filter-tag {
            background: #333;
            color: #fff;
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        body.dark-mode .filter-tag:hover {
            background: #4a90e2;
            border-color: #4a90e2;
        }
        
        body.dark-mode .filter-tag.active {
            background: #4a90e2;
            border-color: #4a90e2;
            color: #fff;
        }
        
        body.dark-mode .results-table {
            background: #2a2a2a;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .results-table th {
            background: #333;
            color: #fff;
            border-bottom-color: rgba(255, 255, 255, 0.2);
        }
        
        body.dark-mode .results-table td {
            border-bottom-color: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.9);
        }
        
        body.dark-mode .results-table tbody tr:hover {
            background-color: rgba(74, 144, 226, 0.1);
        }
        
        body.dark-mode .view-btn {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: #fff;
        }
        
        body.dark-mode .view-btn:hover {
            background: linear-gradient(135deg, #357abd 0%, #2868a8 100%);
        }
        
        /* Detail页面深色模式 */
        body.dark-mode .detail-card {
            background: #2a2a2a;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .detail-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .detail-title {
            color: #fff;
        }
        
        body.dark-mode .detail-subtitle {
            color: rgba(255, 255, 255, 0.7);
        }
        
        body.dark-mode .section-title {
            color: #fff;
            border-bottom-color: rgba(255, 255, 255, 0.2);
        }
        
        body.dark-mode .info-label {
            color: rgba(255, 255, 255, 0.6);
        }
        
        body.dark-mode .info-value {
            color: #fff;
        }
        
        body.dark-mode .structure-card {
            background: #333;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .structure-title {
            color: #fff;
        }
        
        body.dark-mode .structure-subtitle {
            color: rgba(255, 255, 255, 0.6);
        }
        
        body.dark-mode .plastic-tag {
            background: rgba(74, 144, 226, 0.2);
            color: #4a90e2;
            border-color: rgba(74, 144, 226, 0.3);
        }
        
        /* BLAST页面深色模式 */
        body.dark-mode .blast-section {
            background: #2a2a2a;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .blast-section-title {
            color: #fff;
        }
        
        body.dark-mode .sequence-input {
            background: #1a1a1a;
            color: #fff;
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        body.dark-mode .sequence-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        body.dark-mode .param-label {
            color: rgba(255, 255, 255, 0.8);
        }
        
        body.dark-mode .param-select,
        body.dark-mode .param-input {
            background: #1a1a1a;
            color: #fff;
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        body.dark-mode .blast-button {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
        }
        
        body.dark-mode .blast-button:hover {
            background: linear-gradient(135deg, #357abd 0%, #2868a8 100%);
        }
        
        body.dark-mode .result-item {
            background: #333;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .result-item:hover {
            border-color: rgba(74, 144, 226, 0.5);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.2);
        }
        
        body.dark-mode .result-header {
            color: #fff;
        }
        
        body.dark-mode .score-badge {
            background: rgba(74, 144, 226, 0.2);
            color: #4a90e2;
        }
        
        /* Statistics页面深色模式 */
        body.dark-mode .chart-container {
            background: #2a2a2a;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .chart-title {
            color: #fff;
        }
        
        /* About页面深色模式 */
        body.dark-mode .about-page {
            background: #1a1a1a;
        }
        
        body.dark-mode .about-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }
        
        body.dark-mode .about-title {
            color: #fff;
        }
        
        body.dark-mode .about-description {
            color: rgba(255, 255, 255, 0.8);
        }
        
        body.dark-mode .about-section {
            background: #2a2a2a;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .about-section-title {
            color: #fff;
        }
        
        body.dark-mode .about-text {
            color: rgba(255, 255, 255, 0.8);
        }
        
        body.dark-mode .team-member {
            background: #333;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .team-member:hover {
            border-color: rgba(74, 144, 226, 0.5);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.2);
        }
        
        body.dark-mode .member-name {
            color: #fff;
        }
        
        body.dark-mode .member-role {
            color: #4a90e2;
        }
        
        body.dark-mode .contact-item {
            background: #333;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .contact-label {
            color: rgba(255, 255, 255, 0.6);
        }
        
        body.dark-mode .contact-value {
            color: #fff;
        }
        
        body.dark-mode .contact-link {
            color: #4a90e2;
        }
        
        body.dark-mode .contact-link:hover {
            color: #357abd;
        }
        
        /* Phylogeny页面深色模式 */
        body.dark-mode .phylogeny-container {
            background: #2a2a2a;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .phylogeny-title {
            color: #fff;
        }
        
        /* 分页深色模式 */
        body.dark-mode .pagination {
            border-top-color: rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .page-btn {
            background: #333;
            color: #fff;
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        body.dark-mode .page-btn:hover {
            background: #4a90e2;
            border-color: #4a90e2;
        }
        
        body.dark-mode .page-btn.active {
            background: #4a90e2;
            border-color: #4a90e2;
        }
        
        body.dark-mode .page-btn:disabled {
            background: #222;
            color: #666;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        /* 加载动画深色模式 */
        body.dark-mode .loading-spinner {
            border-color: rgba(255, 255, 255, 0.1);
            border-top-color: #4a90e2;
        }
        
        /* 返回按钮深色模式 */
        body.dark-mode .back-button {
            background: #333;
            color: #fff;
        }
        
        body.dark-mode .back-button:hover {
            background: #4a90e2;
        }
        
        /* 滚动条深色模式 */
        body.dark-mode ::-webkit-scrollbar {
            background: #1a1a1a;
        }
        
        body.dark-mode ::-webkit-scrollbar-thumb {
            background: #444;
        }
        
        body.dark-mode ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <header class="header">
        <div class="nav-container">
            <div class="logo-section">
                <img src="images/logo_svg.svg" alt="PlaszymeDB Logo" class="logo-icon">
                <div class="logo-text">PlaszymeDB</div>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li><a href="#" class="active" onclick="showPage('home')">HOME</a></li>
                    <li><a href="#" onclick="showPage('browse')">BROWSE</a></li>
                    <li><a href="#" onclick="showPage('blast')">BLAST</a></li>
                    <li><a href="#" onclick="showPage('phylogeny')">PHYLOGENY</a></li>
                    <li><a href="#" onclick="showPage('statistics')">STATISTICS</a></li>
                    <li><a href="#" onclick="downloadCSV(); return false;">DOWNLOAD</a></li>
                    <li><a href="#" onclick="showPage('about')">ABOUT</a></li>
                </ul>
            </nav>
            <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
                <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- 首页内容 -->
    <div id="home-page">
        <div class="main-container">
            <!-- Hero区域 -->
            <section class="hero-section">
                <h1 class="hero-title">PlaszymeDB</h1>
                <p class="hero-subtitle">The Comprehensive Database of Plastic-Degrading Enzymes</p>
            </section>

            <!-- 搜索框 -->
            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="home-search-input" class="search-input" placeholder="Search by enzyme name, EC number, plastic type, or protein sequence...">
                    <button class="search-button" onclick="performHomeSearch()">Search</button>
                </div>
            </div>

            <!-- 功能卡片 -->
            <section class="features-grid">
                <div class="feature-card" onclick="showPage('browse')">
                    <div class="feature-icon">📊</div>
                    <h3 class="feature-title">Browse Database</h3>
                    <p class="feature-description">Explore all enzymes with advanced filtering and sorting options</p>
                </div>
                <div class="feature-card" onclick="showPage('blast')">
                    <div class="feature-icon">🧬</div>
                    <h3 class="feature-title">BLAST Search</h3>
                    <p class="feature-description">Find similar sequences using BLAST algorithm against our curated database</p>
                </div>
                <div class="feature-card" onclick="showPage('phylogeny')">
                    <div class="feature-icon">🌳</div>
                    <h3 class="feature-title">Phylogenetic Trees</h3>
                    <p class="feature-description">Explore evolutionary relationships with interactive phylogenetic visualizations</p>
                </div>
            </section>

            <!-- 统计数据 -->
            <section class="stats-section">
                <div class="stats-header">
                    <h2 class="stats-title">Database Statistics</h2>
                    <p class="stats-subtitle">Last updated: January 2025</p>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="home-total-enzymes">-</div>
                        <div class="stat-label">Total Enzymes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="home-plastic-types">-</div>
                        <div class="stat-label">Plastic Types</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="home-unique-sequences">-</div>
                        <div class="stat-label">Unique Sequences</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="home-3d-structures">-</div>
                        <div class="stat-label">3D Structures</div>
                    </div>
                </div>
            </section>

            <!-- 数据可视化 -->
            <section class="visualization-section">
                <div class="viz-header">
                    <h2 class="stats-title">Data Overview</h2>
                    <p class="stats-subtitle">Distribution of enzymes in the database</p>
                </div>
                <div class="viz-grid">
                    <div class="viz-card">
                        <h3 class="viz-title">Plastic Type Distribution</h3>
                        <div class="chart-placeholder">
                            <img src="images/5278ecf2a6f7241e73999ee4ac0a1932.jpg" alt="Plastic Type Distribution Chart">
                        </div>
                    </div>
                </div>
            </section>

            <!-- 更新历史 -->
            <section class="stats-section">
                <h2 class="stats-title" style="margin-bottom: 2rem;">Recent Updates</h2>
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">January 15, 2025</div>
                            <div class="timeline-title">Version 0.2.4 Released</div>
                            <div class="timeline-desc">Added 200 new enzyme entries and updated 3D structures</div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">October 20, 2024</div>
                            <div class="timeline-title">Version 0.2.3 Released</div>
                            <div class="timeline-desc">Sequence corrections and phylogenetic tree updates</div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <div class="timeline-date">July 8, 2024</div>
                            <div class="timeline-title">Version 0.2.2 Released</div>
                            <div class="timeline-desc">Major structure update with iTOL integration</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- 浏览页面 -->
    <div id="browse-page" class="browse-page">
        <div class="main-container">
            <div class="browse-header">
                <h1 class="browse-title">Browse PlaszymeDB</h1>
                <p class="browse-subtitle" id="browse-subtitle">Explore our collection of plastic-degrading enzymes</p>
            </div>
            
            <!-- 搜索和筛选 -->
            <div class="browse-search-section">
                <div class="browse-search-box">
                    <input type="text" id="browse-search-input" class="browse-search-input" placeholder="Enter enzyme name, EC number, sequence, gene name...">
                    <button class="btn btn-primary" onclick="performSearch()">Search</button>
                </div>
                
                <div class="filter-row">
                    <div class="filter-item">
                        <label class="filter-label">Plastic Type</label>
                        <select id="plastic-filter" class="filter-select" onchange="performSearch()">
                            <option value="">All</option>
                            <option value="PET">PET</option>
                            <option value="DBP">DBP</option>
                            <option value="ECOFLEX">ECOFLEX</option>
                            <option value="ECOVIO-FT">ECOVIO-FT</option>
                            <option value="PE">PE</option>
                            <option value="PP">PP</option>
                            <option value="PVC">PVC</option>
                            <option value="PS">PS</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label class="filter-label">EC Classification</label>
                        <select id="ec-filter" class="filter-select" onchange="performSearch()">
                            <option value="">All</option>
                            <option value="1.14.12.7">1.14.12.7</option>
                            <option value="3.1.1.-">3.1.1.-</option>
                            <option value="3.1.1">3.1.1</option>
                            <option value="3.1">3.1</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label class="filter-label">Host Organism</label>
                        <select id="host-filter" class="filter-select" onchange="performSearch()">
                            <option value="">All</option>
                            <option value="Rhodococcus">Rhodococcus</option>
                            <option value="Bacillus">Bacillus</option>
                            <option value="Marinobacter">Marinobacter</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- 结果表格 -->
            <div class="results-container">
                <div class="results-header">
                    <div class="results-info" id="results-info">Loading...</div>
                    <div class="export-buttons">
                        <button class="btn btn-secondary btn-small" onclick="exportSelected()">Export Selected</button>
                        <button class="btn btn-secondary btn-small" onclick="exportAll()">Export All</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 50px;">
                                    <input type="checkbox" class="checkbox" id="select-all" onchange="toggleSelectAll()">
                                </th>
                                <th>Protein_ID</th>
                                <th>Enzyme Name</th>
                                <th>Plastic Type</th>
                                <th>EC Number</th>
                                <th>Host Organism</th>
                                <th>Gene Name</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="results-tbody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 2rem;">
                                    <div class="loading-spinner"></div>
                                    <div>Loading data...</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- BLAST页面 -->
    <div id="blast-page" class="blast-page">
        <div class="blast-main-container">
            <!-- 页面标题 -->
            <div class="blast-header">
                <h1 class="blast-title">Sequence Similarity Search</h1>
                <p class="blast-subtitle">Find similar sequences in our curated database of 1,245 plastic-degrading enzymes</p>
                <p class="blast-description">
                    Use advanced sequence alignment algorithms to quickly find plastic-degrading enzymes most similar to your query sequence.
                    Supports FASTA format input and various search parameter settings.
                </p>
            </div>
            
            <!-- 搜索表单 -->
            <div class="blast-search-card">
                <div class="blast-search-header">
                    <h2 class="blast-search-title">Input Protein Sequence</h2>
                    <p class="blast-search-description">Align against plastic-degrading enzymes in the database</p>
                </div>

                <form class="blast-search-form" id="blastSearchForm">
                    <!-- 序列输入区域 -->
                    <div class="blast-input-section">
                        <label class="blast-input-label" for="blastSequenceInput">Protein Sequence</label>
                        <textarea
                            id="blastSequenceInput"
                            class="blast-sequence-textarea"
                            placeholder="Enter protein sequence (FASTA format or raw amino acid sequence)..."
                            required
                        ></textarea>
                        <div class="blast-input-help">
                            Paste your protein sequence (amino acids only).
                            <button type="button" class="blast-example-btn" onclick="loadBlastExample()">Load Example Sequence</button>
                        </div>
                    </div>

                    <!-- 搜索参数 -->
                    <div class="blast-parameters-section">
                        <h3 class="blast-parameters-title">Search Parameters</h3>
                        <div class="blast-param-grid">
                            <div class="blast-param-group">
                                <label class="blast-param-label">Maximum Results</label>
                                <select class="blast-param-select" id="blastMaxResults">
                                    <option value="10">Top 10 matches</option>
                                    <option value="25" selected>Top 25 matches</option>
                                    <option value="50">Top 50 matches</option>
                                    <option value="100">Top 100 matches</option>
                                </select>
                                <div class="blast-param-help">Number of best matches to display</div>
                            </div>

                            <div class="blast-param-group">
                                <label class="blast-param-label">Similarity Threshold</label>
                                <select class="blast-param-select" id="blastThreshold">
                                    <option value="high">High (>70% identity)</option>
                                    <option value="medium" selected>Medium (>30% identity)</option>
                                    <option value="low">Low (>10% identity)</option>
                                    <option value="all">Show all matches</option>
                                </select>
                                <div class="blast-param-help">Minimum similarity to include in results</div>
                            </div>

                            <div class="blast-param-group">
                                <label class="blast-param-label">Plastic Type Filter</label>
                                <select class="blast-param-select" id="blastPlasticFilter">
                                    <option value="all" selected>All plastic types</option>
                                    <option value="PET">PET only</option>
                                    <option value="PE">PE only</option>
                                    <option value="PP">PP only</option>
                                    <option value="PVC">PVC only</option>
                                    <option value="PS">PS only</option>
                                    <option value="DBP">DBP only</option>
                                    <option value="ECOFLEX">ECOFLEX only</option>
                                </select>
                                <div class="blast-param-help">Filter results by plastic substrate type</div>
                            </div>

                            <div class="blast-param-group">
                                <label class="blast-param-label">Include Structure</label>
                                <select class="blast-param-select" id="blastStructureFilter">
                                    <option value="all" selected>All enzymes</option>
                                    <option value="structures">Only enzymes with 3D structure</option>
                                </select>
                                <div class="blast-param-help">Show only enzymes with known structures</div>
                            </div>
                        </div>
                    </div>

                    <!-- 提交按钮 -->
                    <div class="blast-submit-section">
                        <button type="submit" class="blast-submit-btn" id="blastSubmitBtn">
                            🔍 Search Similar Sequences
                        </button>
                    </div>
                </form>

                <!-- 加载状态 -->
                <div class="blast-loading-container" id="blastLoadingContainer" style="display: none;">
                    <div class="blast-loading-spinner"></div>
                    <div class="blast-loading-text">Searching database...</div>
                    <div class="blast-loading-details">Aligning against 1,245 enzyme sequences</div>
                </div>
            </div>

            <!-- 结果区域 -->
            <div class="blast-results-container" id="blastResultsContainer" style="display: none;">
                <div class="blast-results-header">
                    <div>
                        <h3 class="blast-results-title">Search Results</h3>
                        <div class="blast-results-info" id="blastResultsInfo">Found 15 similar sequences</div>
                    </div>
                    <div class="blast-results-actions">
                        <button class="blast-action-btn" onclick="exportBlastResults('fasta')">Export FASTA</button>
                        <button class="blast-action-btn" onclick="exportBlastResults('csv')">Export CSV</button>
                        <button class="blast-action-btn blast-action-primary" onclick="newBlastSearch()">New Search</button>
                    </div>
                </div>

                <div class="blast-results-table-container">
                    <table class="blast-results-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Enzyme Name</th>
                                <th>Host Organism</th>
                                <th>Plastic Type</th>
                                <th>Identity</th>
                                <th>Score</th>
                                <th>Coverage</th>
                                <th>Alignment Preview</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="blastResultsTableBody">
                            <!-- 结果将在这里动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ABOUT页面 -->
    <div id="about-page" class="about-page">
        <div class="about-main-container">
            <!-- 页面标题区域 -->
            <div class="about-header">
                <div class="about-logo">
                    <img src="images/logo_svg.svg" alt="PlaszymeDB Logo" class="about-logo-icon">
                </div>
                <div class="about-content">
                    <h1 class="about-title">About PlaszymeDB</h1>
                    <p class="about-description">
                        PlaszymeDB is a comprehensive database dedicated to plastic-degrading enzymes, 
                        providing researchers worldwide with detailed information about enzymes capable 
                        of breaking down various plastic polymers.
                    </p>
                </div>
            </div>
            
            <!-- 内容区域 -->
            <div class="about-sections">
                <!-- 数据库概述 -->
                <div class="about-section">
                    <h2 class="about-section-title">Database Overview</h2>
                    <p class="about-text">
                        The database currently contains 474 plastic-degrading enzymes from diverse microorganisms 
                        that have been reported in the scientific literature for their plastic biodegradation capabilities. 
                        These enzymes target 34 different types of plastic polymers, with detailed characterization data 
                        including 3D structures, phylogenetic relationships...
                    </p>
                    <p class="about-text">
                        PlaszymeDB is updated regularly to incorporate new discoveries and research findings in the 
                        rapidly evolving field of plastic biodegradation. The database serves as a central resource 
                        for researchers working on plastic pollution solutions, enzyme engineering, and environmental 
                        biotechnology applications.
                    </p>
                </div>
                
                <!-- 功能特性 -->
                <div class="about-section">
                    <h2 class="about-section-title">Database Features</h2>
                    <p class="about-text">
                        PlaszymeDB provides several options for exploring and utilizing the curated enzyme data:
                    </p>
                    <ul class="feature-list">
                        <li>
                            <span class="feature-icon">🔍</span>
                            <span class="feature-text">
                                Search and browse enzymes by name, EC number, plastic type, or host organism with 
                                advanced filtering capabilities
                            </span>
                        </li>
                        <li>
                            <span class="feature-icon">🧬</span>
                            <span class="feature-text">
                                Access detailed enzyme information including sequences, structures, and biochemical properties
                            </span>
                        </li>
                        <li>
                            <span class="feature-icon">🔬</span>
                            <span class="feature-text">
                                Perform BLAST searches to identify similar sequences in the curated database
                            </span>
                        </li>
                        <li>
                            <span class="feature-icon">🌳</span>
                            <span class="feature-text">
                                Explore evolutionary relationships through interactive phylogenetic trees powered by iTOL
                            </span>
                        </li>
                        <li>
                            <span class="feature-icon">📊</span>
                            <span class="feature-text">
                                View comprehensive statistics and visualizations of enzyme distribution and properties
                            </span>
                        </li>
                        <li>
                            <span class="feature-icon">💾</span>
                            <span class="feature-text">
                                Download sequence data and metadata in standard formats for further analysis
                            </span>
                        </li>
                    </ul>
                </div>
                
                <!-- 数据来源与质量 -->
                <div class="about-section">
                    <h2 class="about-section-title">Data Sources and Quality</h2>
                    <p class="about-text">
                        The enzyme items in PlaszymeDB have mainly been integrated and collected from within the degradation enzyme databases (such as PMBD, PlasticDB, PAZY), and have undergone comparison and verification with biological databases (such as UniProt, NCBI and PDB). Each entry contains diverse information and is internally displayed.
                    </p>
                    <p class="about-text">
                        The database maintains strict quality control standards, with regular validation of sequence data, 
                        structural information, and literature references. Cross-references to external databases ensure 
                        data consistency and provide users with access to additional resources and information.
                    </p>
                </div>
                
                <!-- 引用信息 -->
                <div class="about-section">
                    <h2 class="about-section-title">Citation</h2>
                    <p class="about-text">
                        If you use PlaszymeDB in your research, please cite our work. A peer-reviewed publication 
                        describing the database is currently in preparation and will be made available upon acceptance.
                    </p>
                    <div class="citation-box">
                        <p class="citation-text">
                            PlaszymeDB: A Comprehensive Database of Plastic-Degrading Enzymes. 
                            [Authors to be determined]. [Journal to be determined], [Year]. 
                            DOI: [To be assigned upon publication]
                        </p>
                        <p class="citation-note">
                            Note: Full citation information will be updated upon publication of the associated research article. You are welcome to contact us via email first.
                        </p>
                    </div>
                </div>
                
                <!-- 贡献与反馈 -->
                <div class="about-section">
                    <h2 class="about-section-title">Contributing to PlaszymeDB</h2>
                    <p class="about-text">
                        We welcome contributions from the scientific community to improve and expand the database. 
                        If you have information about plastic-degrading enzymes that could enhance our collection, 
                        or if you notice any errors or omissions, please contact us with your suggestions.
                    </p>
                    <p class="about-text">
                        We actively monitor the literature for new discoveries and appreciate notifications about 
                        recent publications or newly characterized enzymes that should be included in future database updates.
                    </p>
                </div>
                
                <!-- 联系信息 -->
                <div class="about-section">
                    <h2 class="about-section-title">Contact Information</h2>
                    <p class="about-text">
                        For questions, suggestions, or collaboration inquiries, please reach out to our team:
                    </p>
                    <div class="contact-grid">
                        <div class="contact-item">
                            <div class="contact-label">Email</div>
                            <div class="contact-value">
                                <a href="mailto:sci.igem@xjtlu.edu.cn" class="contact-link">sci.igem@xjtlu.edu.cn</a>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-label">GitHub</div>
                            <div class="contact-value">
                                <a href="https://github.com/Tsutayaaa/PlaszymeDB" class="contact-link">https://github.com/Tsutayaaa/PlaszymeDB</a>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-label">Institution</div>
                            <div class="contact-value">
                                XJTLU-AI-CHINA
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-label">Last Updated</div>
                            <div class="contact-value">
                                October 2025
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PHYLOGENY页面 -->
    <div id="phylogeny-page" class="phylogeny-page">
        <div class="phylogeny-main-container">
            
            <!-- iTOL嵌入式iframe容器 -->
            <div class="itol-embedded-container">
                
                <div class="itol-embedded-content">
                    <iframe 
                        id="phylogeny-iframe" 
                        src="https://itol.embl.de/shared/mtfbwy" 
                        frameborder="0" 
                        allowfullscreen
                        title="PlaszymeDB Phylogenetic Trees">
                        <div class="iframe-fallback">
                            <h3>Failed to load phylogenetic tree</h3>
                            <p>Your browser does not support iframe or network connection issue</p>
                            <p><a href="https://itol.embl.de/shared/mtfbwy" target="_blank">Click here to visit iTOL directly</a></p>
                        </div>
                    </iframe>
                </div>
                
                <div class="itol-embedded-footer">
                    <div class="itol-footer-info">
                        <p>
                            <strong>Data Source:</strong> PlaszymeDB Plastic-Degrading Enzyme Database | 
                            <strong>Platform:</strong> <a href="https://itol.embl.de" target="_blank">iTOL (Interactive Tree of Life)</a> |
                            <strong>Last Updated:</strong> 2025-01-15
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 新的详情页面 -->
    <div id="detail-page" class="detail-page">
        <!-- 加载状态 -->
        <div id="detail-loading" class="loading-container" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Loading enzyme information...</p>
        </div>
        
        <!-- 错误状态 -->
        <div id="detail-error" class="error-container" style="display: none;">
            <div class="error-icon">❌</div>
            <h3>Load Failed</h3>
            <p id="error-message">Unable to retrieve enzyme information, please try again later.</p>
            <button class="btn btn-primary" onclick="showPage('browse')">Back to List</button>
        </div>
        
        <div id="detail-content" class="detail-main-container">
            <!-- 面包屑导航 -->
            <div class="breadcrumb">
                <a href="#" onclick="showPage('home')">Home</a> / 
                <a href="#" onclick="showPage('browse')">Browse</a> / 
                <span id="breadcrumb-plz-id">PLZ_001</span>
            </div>
            
            <!-- 页面标题 -->
            <div class="page-header">
                <h1 id="detail-title" class="header-title">PLZ_001 - PETase</h1>
                <p id="detail-subtitle" class="header-subtitle">PET-degrading enzyme from <em>Ideonella sakaiensis</em></p>
            </div>
            
            <!-- 基本信息条带 - 弱化展示 -->
            <div class="basic-info-strip">
                <div class="basic-info-grid" id="basic-info-grid">
                    <div class="basic-info-item">
                        <span class="basic-info-label">EC Number:</span>
                        <span id="detail-ec-number" class="basic-info-value">3.1.1.101</span>
                    </div>
                    <div class="basic-info-item">
                        <span class="basic-info-label">Plastic Type:</span>
                        <span id="detail-plastic-type" class="plastic-tag-small">PET</span>
                    </div>
                    <div class="basic-info-item">
                        <span class="basic-info-label">Gene Name:</span>
                        <span id="detail-gene-name" class="basic-info-value">ISF6_4831</span>
                    </div>
                    <div class="basic-info-item">
                        <span class="basic-info-label">Host Organism:</span>
                        <span id="detail-host-organism" class="basic-info-value">/</span>
                    </div>
                    <div class="basic-info-item">
                        <span class="basic-info-label">Taxonomy:</span>
                        <span id="detail-taxonomy" class="basic-info-value">/</span>
                    </div>
                </div>
            </div>
            
            <!-- 结构信息 - 突出展示 -->
            <section class="structure-section">
                <div class="section-header">
                    <h2 class="section-title">Molecular Structure Information</h2>
                    <p class="section-subtitle">3D structural visualization of proteins and plastic substrates</p>
                </div>
                
                <div class="structure-grid">
                    <!-- 蛋白质3D结构 -->
                    <div class="structure-card">
                        <div class="structure-card-header">
                            <h3 class="structure-card-title">Protein 3D Structure</h3>
                            <p class="structure-card-subtitle">Interactive 3D structure visualization based on Mol*</p>
                        </div>
                        
                        <!-- 3D结构查看器容器 -->
                        <div id="protein-3d-viewer" style="min-height: 420px; overflow: visible;">
                            <!-- 查看器将在这里初始化 -->
                        </div>
                    </div>
                    
                    <!-- 塑料化学结构 -->
                    <div class="structure-card">
                        <div class="structure-card-header">
                            <h3 class="structure-card-title">Plastic Chemical Structure</h3>
                            <p id="plastic-structure-subtitle" class="structure-card-subtitle">Loading...</p>
                        </div>
                        
                        <!-- 塑料类型选择器 -->
                        <div id="plastic-selector-container" style="margin-bottom: 1rem; text-align: center; display: none;">
                            <label for="plastic-type-select" style="margin-right: 0.5rem; font-weight: 500;">Select Plastic Type:</label>
                            <select id="plastic-type-select" class="filter-select" onchange="loadPlasticStructure(this.value)" style="min-width: 200px; padding: 0.5rem;">
                                <option value="">-- Please Select --</option>
                            </select>
                        </div>
                        
                        <!-- 化学结构查看器容器 -->
                        <div id="ketcher-container" style="min-height: 420px; border-radius: 12px; overflow: hidden; display: none;">
                            <!-- Ketcher 将在这里初始化 -->
                        </div>
                        
                        <!-- 加载/错误提示 -->
                        <div id="plastic-structure-loading" class="structure-viewer" style="display: block;">
                            <div class="structure-placeholder">⚛️</div>
                            <div class="structure-label">Waiting to load plastic chemical structure...</div>
                            <div class="structure-meta">This feature will display the plastic molecular structure that the enzyme can degrade</div>
                        </div>
                        
                        <div id="plastic-structure-error" class="structure-viewer" style="display: none; background: linear-gradient(135deg, #fff5f5, #ffe5e5);">
                            <div class="structure-placeholder">⚠️</div>
                            <div class="structure-label" id="plastic-structure-error-msg">No chemical structure data available</div>
                        </div>
                        
                        <!-- 结构信息 -->
                        <div id="plastic-structure-info" style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; display: none;">
                            <div id="plastic-smiles-info" style="font-size: 0.9rem; color: #666; word-break: break-all;">
                                <strong>SMILES:</strong> <span id="plastic-smiles-text"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 外部数据库链接 -->
            <div class="content-section full-width">
                <h3 class="content-section-title">External Database Links</h3>
                <div id="db-links-container" class="db-links">
                    <!-- 动态生成的数据库链接 -->
                </div>
            </div>
            
            <!-- 序列信息 -->
            <div class="content-section full-width">
                <h3 class="content-section-title">Sequence Information</h3>
                <div class="sequence-header">
                    <span id="sequence-info" class="sequence-info">Sequence Length: / | Molecular Weight: / | Theoretical pI: /</span>
                    <button id="download-fasta-btn" class="download-btn" style="display: none;">Download FASTA</button>
                </div>
                <div id="sequence-container" class="sequence-box">
                    <div id="no-sequence" class="text-center" style="padding: 20px; color: #666;">
                        No sequence information available
                    </div>
                </div>
            </div>
            
            <!-- 参考文献 -->
            <div class="content-section full-width">
                <h3 class="content-section-title">References</h3>
                <div id="references-container">
                    <div id="no-references" class="text-center" style="padding: 20px; color: #666;">
                        No reference information available
                    </div>
                </div>
            </div>
            
            <!-- 操作按钮 -->
            <div class="action-bar">
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="showPage('browse')">Back to List</button>
                    <button class="btn btn-primary">Add to Compare</button>
                </div>
            </div>
        </div>
    </div>

    <!-- STATISTICS 页面 -->
    <div id="statistics-page" class="statistics-page" style="display: none;">
        <div class="statistics-container">
            <h1 class="statistics-title">Database Statistics</h1>
            <div class="statistics-images">
                <div class="stat-image-wrapper">
                    <img src="images/5278ecf2a6f7241e73999ee4ac0a1932.jpg" alt="Statistics Chart 1">
                </div>
                <div class="stat-image-wrapper">
                    <img src="images/a35915b42c2c207294af2752cf0719d9.jpg" alt="Statistics Chart 2">
                </div>
                <div class="stat-image-wrapper">
                    <img src="images/b30ccf0bb530ffef487987a81e6ad4e9.png" alt="Statistics Chart 3">
                </div>
                <div class="stat-image-wrapper">
                    <img src="images/2a915a63905da83ac5c87ae015b7a0af.png" alt="Statistics Chart 4">
                </div>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>About PlaszymeDB</h4>
                <p>PlaszymeDB is the most comprehensive database for plastic-degrading enzymes, providing researchers with detailed information and analysis tools.</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <p><a href="#">Documentation</a></p>
                <p><a href="#">API Reference</a></p>
                <p><a href="#">Citation Guide</a></p>
            </div>
            <div class="footer-section">
                <h4>Resources</h4>
                <p><a href="#">Download Data</a></p>
                <p><a href="#">Submit Data</a></p>
                <p><a href="#">Contact Support</a></p>
            </div>
            <div class="footer-section">
                <h4>Contact Details</h4>
                <p>Email: sci.igem@xjtlu.edu.cn</p>
                <p>GitHub: https://github.com/Tsutayaaa/PlaszymeDB</p>
                <p>Institution: XJTLU-AI-CHINA</p>
                <p>Last Updated: January 2025, Version 0.2.4</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 PlaszymeDB. All rights reserved. | Privacy Policy</p>
        </div>
    </footer>

    <script>
        // ================== 主题切换功能 ==================
        
        // 初始化主题
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
            }
        }
        
        // 切换主题
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }
        
        // 页面加载时初始化主题
        initTheme();
        
        // ================== 下载功能 ==================
        
        // Download CSV file function
        function downloadCSV() {
            const link = document.createElement('a');
            link.href = 'PlaszymeDB_v1.1.csv';
            link.download = 'PlaszymeDB_v1.1.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Optional: Show a notification
            console.log('Downloading PlaszymeDB_v1.1.csv...');
        }
        
        function showPage(page) {
            // 隐藏所有页面
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('browse-page').style.display = 'none';
            document.getElementById('detail-page').style.display = 'none';
            document.getElementById('blast-page').style.display = 'none';
            document.getElementById('phylogeny-page').style.display = 'none';
            document.getElementById('statistics-page').style.display = 'none';
            document.getElementById('about-page').style.display = 'none';
            
            // 更新导航栏活动状态
            const navLinks = document.querySelectorAll('.nav-menu a');
            navLinks.forEach(link => link.classList.remove('active'));
            
            // 显示选择的页面
            if (page === 'home') {
                document.getElementById('home-page').style.display = 'block';
                navLinks[0].classList.add('active');
                // 加载统计信息
                if (!databaseStats) {
                    loadDatabaseStats();
                } else {
                    updateHomeStats();
                }
            } else if (page === 'browse') {
                document.getElementById('browse-page').style.display = 'block';
                navLinks[1].classList.add('active');
                // 加载统计信息和初始数据
                setTimeout(() => {
                    loadDatabaseStats();
                    performSearch();
                }, 100);
            } else if (page === 'blast') {
                document.getElementById('blast-page').style.display = 'block';
                navLinks[2].classList.add('active');
                // 重置BLAST表单
                resetBlastForm();
            } else if (page === 'detail') {
                document.getElementById('detail-page').style.display = 'block';
                navLinks[1].classList.add('active');
            } else if (page === 'phylogeny') {
                document.getElementById('phylogeny-page').style.display = 'block';
                navLinks[3].classList.add('active');
                // 模拟树图加载
                setTimeout(() => {
                    const loadingOverlay = document.getElementById('loading-overlay');
                    if (loadingOverlay) {
                        loadingOverlay.style.display = 'none';
                    }
                }, 2000);
            } else if (page === 'statistics') {
                document.getElementById('statistics-page').style.display = 'block';
                navLinks[4].classList.add('active');
            } else if (page === 'about') {
                document.getElementById('about-page').style.display = 'block';
                navLinks[6].classList.add('active');
            }
            
            // 滚动到顶部
            window.scrollTo(0, 0);
        }
        
        // PHYLOGENY页面功能
        function updateTree() {
            const dataset = document.getElementById('tree-dataset').value;
            const mode = document.getElementById('display-mode').value;
            const colorScheme = document.getElementById('color-scheme').value;
            
            // 显示加载遮罩
            document.getElementById('loading-overlay').style.display = 'flex';
            
            // 更新树图标题
            const titles = {
                'all': 'All Plastic-Degrading Enzymes',
                'pet': 'PET-Degrading Enzymes',
                'pe': 'PE-Degrading Enzymes',
                'pp': 'PP-Degrading Enzymes',
                'ec31': 'EC 3.1.x.x Esterases',
                'ec32': 'EC 3.2.x.x Glycosidases'
            };
            
            document.getElementById('current-tree-title').textContent = 
                `${titles[dataset]} - Phylogenetic Tree`;
            
            // 更新统计信息
            const counts = {
                'all': '1,245',
                'pet': '456',
                'pe': '234',
                'pp': '189',
                'ec31': '678',
                'ec32': '123'
            };
            
            document.getElementById('sequence-count').textContent = counts[dataset];
            
            // 模拟更新iTOL URL
            const iframe = document.getElementById('itol-frame');
            const newUrl = `https://itol.embl.de/tree/12345678901234567890123456789012?mode=${mode}&colorscheme=${colorScheme}&dataset=${dataset}&width=1200&height=700`;
            
            setTimeout(() => {
                iframe.src = newUrl;
                setTimeout(() => {
                    document.getElementById('loading-overlay').style.display = 'none';
                }, 1500);
            }, 500);
        }
        
        function resetTree() {
            document.getElementById('tree-dataset').value = 'all';
            document.getElementById('display-mode').value = 'rectangular';
            document.getElementById('color-scheme').value = 'plastic';
            updateTree();
        }
        
        function exportTree(format) {
            alert(`Export phylogenetic tree in ${format.toUpperCase()} format`);
        }
        
        function toggleFullscreen() {
            const container = document.querySelector('.tree-container');
            if (!document.fullscreenElement) {
                container.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        // BROWSE页面搜索功能
        let currentResults = [];
        let selectedItems = [];
        let databaseStats = null;
        
        // 加载数据库统计信息
        function loadDatabaseStats() {
            fetch('stats.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        databaseStats = data.statistics;
                        updateBrowseHeader();
                        updateFilters();
                        updateHomeStats();
                    }
                })
                .catch(error => {
                    console.error('Failed to retrieve statistics:', error);
                });
        }
        
        // 更新首页统计信息
        function updateHomeStats() {
            if (databaseStats) {
                const totalEnzymes = document.getElementById('home-total-enzymes');
                const plasticTypes = document.getElementById('home-plastic-types');
                const uniqueSequences = document.getElementById('home-unique-sequences');
                const structures3d = document.getElementById('home-3d-structures');
                
                if (totalEnzymes) totalEnzymes.textContent = databaseStats.total_enzymes || '0';
                if (plasticTypes) plasticTypes.textContent = databaseStats.plastic_types || '0';
                if (uniqueSequences) uniqueSequences.textContent = databaseStats.unique_sequences || '0';
                if (structures3d) structures3d.textContent = databaseStats.structures_3d || '0';
            }
        }
        
        // 更新BROWSE页面标题
        function updateBrowseHeader() {
            if (databaseStats) {
                const subtitle = document.getElementById('browse-subtitle');
                if (subtitle) {
                    subtitle.textContent = `Explore our collection of ${databaseStats.total_enzymes} plastic-degrading enzymes`;
                }
            }
        }
        
        // 更新筛选器选项
        function updateFilters() {
            if (databaseStats && databaseStats.plastic_distribution) {
                const plasticFilter = document.getElementById('plastic-filter');
                if (plasticFilter) {
                    // 清空现有选项（保留"全部"）
                    while (plasticFilter.children.length > 1) {
                        plasticFilter.removeChild(plasticFilter.lastChild);
                    }
                    
                    // 添加数据库中的塑料类型
                    databaseStats.plastic_distribution.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.plastic;
                        option.textContent = `${item.plastic} (${item.count})`;
                        plasticFilter.appendChild(option);
                    });
                }
            }
            
            if (databaseStats && databaseStats.ec_distribution) {
                const ecFilter = document.getElementById('ec-filter');
                if (ecFilter) {
                    // 清空现有选项（保留"全部"）
                    while (ecFilter.children.length > 1) {
                        ecFilter.removeChild(ecFilter.lastChild);
                    }
                    
                    // 添加数据库中的EC编号
                    databaseStats.ec_distribution.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.ec_number;
                        option.textContent = `${item.ec_number} (${item.count})`;
                        ecFilter.appendChild(option);
                    });
                }
            }
            
            if (databaseStats && databaseStats.host_distribution) {
                const hostFilter = document.getElementById('host-filter');
                if (hostFilter) {
                    // 清空现有选项（保留"全部"）
                    while (hostFilter.children.length > 1) {
                        hostFilter.removeChild(hostFilter.lastChild);
                    }
                    
                    // 添加数据库中的宿主生物
                    databaseStats.host_distribution.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.host;
                        option.textContent = `${item.host} (${item.count})`;
                        hostFilter.appendChild(option);
                    });
                }
            }
        }
        
        // 执行搜索
        function performSearch() {
            const search = document.getElementById('browse-search-input').value;
            const plastic = document.getElementById('plastic-filter').value;
            const ec = document.getElementById('ec-filter').value;
            const host = document.getElementById('host-filter').value;
            
            // 构建查询参数
            const params = new URLSearchParams();
            if (search) params.append('search', search);
            if (plastic) params.append('plastic', plastic);
            if (ec) params.append('ec', ec);
            if (host) params.append('host', host);
            
            // 显示加载状态
            showLoadingState();
            
            // 发送请求
            fetch('search.php?' + params.toString())
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        currentResults = data.results;
                        displayResults(data.results, data.total);
                    } else {
                        showErrorMessage(data.message || 'Search failed');
                    }
                })
                .catch(error => {
                    console.error('Search error:', error);
                    showErrorMessage('Network error, please check your connection');
                });
        }
        
        // 显示搜索结果
        function displayResults(results, total) {
            const tbody = document.getElementById('results-tbody');
            const resultsInfo = document.getElementById('results-info');
            
            // 更新结果信息
            resultsInfo.textContent = `Showing 1-${Math.min(results.length, 50)} / ${total} results`;
            
            // 清空表格
            tbody.innerHTML = '';
            
            if (results.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem; color: #666;">
                            No matching results found
                        </td>
                    </tr>
                `;
                return;
            }
            
            // 添加结果行
            results.forEach((item, index) => {
                const row = createResultRow(item, index);
                tbody.appendChild(row);
            });
        }
        
        // 创建结果行
        function createResultRow(item, index) {
            const row = document.createElement('tr');
            
            // 获取塑料类型的颜色
            const plasticColor = getPlasticColor(item.plastic);
            
            row.innerHTML = `
                <td>
                    <input type="checkbox" class="checkbox result-checkbox" value="${item.PLZ_ID}" onchange="updateSelection()">
                </td>
                <td><strong>${item.protein_id || 'N/A'}</strong></td>
                <td>${item.enzyme_name || 'N/A'}</td>
                <td>
                    <span class="plastic-tag" style="background: ${plasticColor.bg}; color: ${plasticColor.text};">
                        ${item.plastic || 'N/A'}
                    </span>
                </td>
                <td>${item.ec_number || 'N/A'}</td>
                <td><em>${item.host_organism || 'N/A'}</em></td>
                <td>${item.gene_name || 'N/A'}</td>
                <td>
                    <a href="#" class="view-link" onclick="showDetail('${item.PLZ_ID}')">View</a>
                </td>
            `;
            
            return row;
        }
        
        // 获取塑料类型颜色
        function getPlasticColor(plastic) {
            const colors = {
                'PET': { bg: '#e8f0fe', text: '#005eb8' },
                'DBP': { bg: '#fff3e0', text: '#ef6c00' },
                'ECOFLEX': { bg: '#e8f5e8', text: '#2e7d32' },
                'ECOVIO-FT': { bg: '#fce4ec', text: '#c2185b' },
                'PE': { bg: '#ffeaa7', text: '#f39c12' },
                'PP': { bg: '#dfe6e9', text: '#2d3436' },
                'PVC': { bg: '#f3e5f5', text: '#7b1fa2' },
                'PS': { bg: '#e1f5fe', text: '#0277bd' }
            };
            return colors[plastic] || { bg: '#f5f5f5', text: '#666' };
        }
        
        // 显示加载状态
        function showLoadingState() {
            const tbody = document.getElementById('results-tbody');
            const resultsInfo = document.getElementById('results-info');
            
            resultsInfo.textContent = 'Searching...';
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 2rem;">
                        <div class="loading-spinner"></div>
                        <div>Searching data...</div>
                    </td>
                </tr>
            `;
        }
        
        // 显示错误信息
        function showErrorMessage(message) {
            const tbody = document.getElementById('results-tbody');
            const resultsInfo = document.getElementById('results-info');
            
            resultsInfo.textContent = 'Search failed';
            tbody.innerHTML = `
                <tr>
                    <td colspan="8" style="text-align: center; padding: 2rem; color: #e74c3c;">
                        Error: ${message}
                    </td>
                </tr>
            `;
        }
        
        // 切换全选
        function toggleSelectAll() {
            const selectAll = document.getElementById('select-all');
            const checkboxes = document.querySelectorAll('.result-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            
            updateSelection();
        }
        
        // 更新选择状态
        function updateSelection() {
            const checkboxes = document.querySelectorAll('.result-checkbox:checked');
            selectedItems = Array.from(checkboxes).map(cb => cb.value);
            
            // 更新全选状态
            const selectAll = document.getElementById('select-all');
            const allCheckboxes = document.querySelectorAll('.result-checkbox');
            selectAll.checked = allCheckboxes.length > 0 && selectedItems.length === allCheckboxes.length;
        }
        
        // 显示详情页面
        function showDetail(plzId) {
            console.log('=== 调用 showDetail ===');
            console.log('PLZ_ID:', plzId);
            
            // 显示详情页面
            showPage('detail');
            
            // 显示加载状态
            showDetailLoading();
            
            const url = `detail.php?plz_id=${encodeURIComponent(plzId)}`;
            console.log('请求URL:', url);
            
            // 从数据库获取数据
            fetch(url)
                .then(response => {
                    console.log('收到响应:', response.status, response.statusText);
                    return response.json();
                })
                .then(data => {
                    console.log('解析的数据:', data);
                    if (data.success) {
                        console.log('数据获取成功，开始填充页面...');
                        populateDetailPage(data.data, plzId);
                    } else {
                        console.error('Failed to retrieve data:', data.error);
                        showDetailError(data.error || 'Failed to retrieve data');
                    }
                })
                .catch(error => {
                    console.error('Failed to retrieve detail data:', error);
                    console.error('Error details:', error.message);
                    showDetailError('Network connection error, please check your network settings');
                });
        }
        
        // 显示加载状态
        function showDetailLoading() {
            document.getElementById('detail-loading').style.display = 'block';
            document.getElementById('detail-error').style.display = 'none';
            document.getElementById('detail-content').style.display = 'none';
        }
        
        // 显示错误状态
        function showDetailError(message) {
            document.getElementById('detail-loading').style.display = 'none';
            document.getElementById('detail-error').style.display = 'block';
            document.getElementById('detail-content').style.display = 'none';
            document.getElementById('error-message').textContent = message;
        }
        
        // 显示详情内容
        function showDetailContent() {
            document.getElementById('detail-loading').style.display = 'none';
            document.getElementById('detail-error').style.display = 'none';
            document.getElementById('detail-content').style.display = 'block';
        }
        
        // 填充详情页面数据
        function populateDetailPage(enzyme, plzId) {
            try {
                console.log('=== 开始填充详情页面 ===');
                console.log('PLZ_ID:', plzId);
                console.log('酶数据:', enzyme);
                
                // 存储当前酶的数据
                currentEnzymeData = enzyme;
                
                // 显示详情内容
                showDetailContent();
                
                // 更新面包屑和标题
                console.log('1. 更新页面头部...');
                updateDetailHeader(enzyme, plzId);
                
                // 更新基本信息
                console.log('2. 更新基本信息...');
                updateBasicInfo(enzyme);
                
                // 更新外部数据库链接
                console.log('3. 更新数据库链接...');
                updateDatabaseLinks(enzyme);
                
                // 更新序列信息
                console.log('4. 更新序列信息...');
                updateSequenceInfo(enzyme, plzId);
                
                // 更新参考文献
                console.log('5. 更新参考文献...');
                updateReferences(enzyme);
                
                // 初始化3D结构查看器
                console.log('6. 初始化3D结构查看器...');
                initProtein3DViewer(plzId);
                
                // 初始化塑料化学结构查看器
                console.log('7. 初始化塑料化学结构查看器...');
                initPlasticStructureViewer(enzyme);
                
                console.log('=== 详情页面填充完成 ===');
                
            } catch (error) {
                console.error('Failed to populate detail page:', error);
                console.error('Error stack:', error.stack);
                showDetailError('Data processing error');
            }
        }
        
        // 更新页面头部信息
        function updateDetailHeader(enzyme, plzId) {
            const plzIdText = plzId || formatValue(enzyme.PLZ_ID);
            const enzymeName = formatValue(enzyme.enzyme_name);
            const hostOrganism = formatValue(enzyme.host_organism);
            
            // 更新面包屑
            document.getElementById('breadcrumb-plz-id').textContent = plzIdText;
            
            // 更新标题
            const titleText = enzymeName !== '/' ? `${plzIdText} - ${enzymeName}` : plzIdText;
            document.getElementById('detail-title').textContent = titleText;
            
            // 更新副标题
            const subtitleText = hostOrganism !== '/' ? `Plastic-degrading enzyme from ${hostOrganism}` : 'Plastic-degrading enzyme';
            document.getElementById('detail-subtitle').innerHTML = subtitleText;
        }
        
        // 更新基本信息
        function updateBasicInfo(enzyme) {
            console.log('更新基本信息:', enzyme);
            
            console.log('EC编号:', enzyme.ec_number, '=>', formatValue(enzyme.ec_number));
            console.log('基因名称:', enzyme.gene_name, '=>', formatValue(enzyme.gene_name));
            console.log('宿主生物:', enzyme.host_organism, '=>', formatValue(enzyme.host_organism));
            console.log('分类信息:', enzyme.taxonomy, '=>', formatValue(enzyme.taxonomy));
            console.log('塑料类型:', enzyme.plastic, '=>', formatValue(enzyme.plastic));
            
            document.getElementById('detail-ec-number').textContent = formatValue(enzyme.ec_number);
            document.getElementById('detail-gene-name').textContent = formatValue(enzyme.gene_name);
            document.getElementById('detail-host-organism').textContent = formatValue(enzyme.host_organism);
            document.getElementById('detail-taxonomy').textContent = formatValue(enzyme.taxonomy);
            
            // 处理塑料类型标签
            const plasticElement = document.getElementById('detail-plastic-type');
            const plasticType = formatValue(enzyme.plastic);
            if (plasticType !== '/') {
                plasticElement.textContent = plasticType;
                plasticElement.className = 'plastic-tag-small';
            } else {
                plasticElement.textContent = '/';
                plasticElement.className = 'basic-info-value';
            }
        }
        
        // 更新外部数据库链接
        function updateDatabaseLinks(enzyme) {
            const container = document.getElementById('db-links-container');
            container.innerHTML = '';
            
            const databases = [
                { 
                    key: 'genbank_ids', 
                    name: 'GenBank', 
                    icon: '🧬', 
                    url: 'https://www.ncbi.nlm.nih.gov/nuccore/' 
                },
                { 
                    key: 'uniprot_ids', 
                    name: 'UniProt', 
                    icon: '🔍', 
                    url: 'https://www.uniprot.org/uniprot/' 
                },
                { 
                    key: 'pdb_ids', 
                    name: 'PDB', 
                    icon: '📊', 
                    url: 'https://www.rcsb.org/structure/' 
                },
                { 
                    key: 'refseq_ids', 
                    name: 'RefSeq', 
                    icon: '🔬', 
                    url: 'https://www.ncbi.nlm.nih.gov/protein/' 
                }
            ];
            
            let hasLinks = false;
            databases.forEach(db => {
                const ids = enzyme[db.key];
                if (ids && ids.trim() && ids !== '/') {
                    // 处理多个ID（用逗号或分号分隔）
                    const idList = ids.split(/[,;]/).map(id => id.trim()).filter(id => id);
                    idList.forEach((id, index) => {
                        if (index === 0 || idList.length === 1) { // 只显示第一个ID或单个ID
                            const link = document.createElement('a');
                            link.href = db.url + id;
                            link.target = '_blank';
                            link.className = 'db-link';
                            link.innerHTML = `
                                <span class="db-icon">${db.icon}</span>
                                <span class="db-text">${db.name}<br><small>${id}</small></span>
                            `;
                            container.appendChild(link);
                            hasLinks = true;
                        }
                    });
                }
            });
            
            if (!hasLinks) {
                container.innerHTML = '<div class="text-center" style="padding: 20px; color: #666;">No external database links available</div>';
            }
        }
        
        // 更新序列信息
        function updateSequenceInfo(enzyme, plzId) {
            const sequence = enzyme.sequence;
            const sequenceInfoElement = document.getElementById('sequence-info');
            const sequenceContainer = document.getElementById('sequence-container');
            const downloadBtn = document.getElementById('download-fasta-btn');
            
            if (sequence && sequence.trim() && sequence !== '/') {
                // 显示序列统计信息
                const length = enzyme.sequence_length || 0;
                const weight = enzyme.molecular_weight || 0;
                const pi = enzyme.theoretical_pi || 0;
                
                sequenceInfoElement.textContent = `Sequence Length: ${length} aa | Molecular Weight: ${weight} kDa | Theoretical pI: ${pi}`;
                
                // 格式化并显示序列
                const enzymeName = formatValue(enzyme.enzyme_name);
                const hostOrganism = formatValue(enzyme.host_organism);
                const header = `>${plzId}|${enzymeName}|${hostOrganism}`;
                
                // 将序列按80个字符换行
                const formattedSequence = sequence.replace(/(.{80})/g, '$1<br>');
                
                sequenceContainer.innerHTML = `${header}<br>${formattedSequence}`;
                downloadBtn.style.display = 'inline-block';
                
                // 绑定下载事件
                downloadBtn.onclick = () => downloadFasta(plzId, enzymeName, hostOrganism, sequence);
                
            } else {
                sequenceInfoElement.textContent = 'Sequence Length: / | Molecular Weight: / | Theoretical pI: /';
                sequenceContainer.innerHTML = '<div id="no-sequence" class="text-center" style="padding: 20px; color: #666;">No sequence information available</div>';
                downloadBtn.style.display = 'none';
            }
        }
        
        // 更新参考文献
        function updateReferences(enzyme) {
            const container = document.getElementById('references-container');
            const reference = enzyme.reference;
            
            if (reference && reference.trim() && reference !== '/') {
                // 将参考文献按行分割并格式化
                const references = reference.split('\n').filter(ref => ref.trim());
                
                if (references.length > 0) {
                    const list = document.createElement('ul');
                    list.className = 'references-list';
                    
                    references.forEach(ref => {
                        const li = document.createElement('li');
                        li.textContent = ref.trim();
                        list.appendChild(li);
                    });
                    
                    container.innerHTML = '';
                    container.appendChild(list);
                } else {
                    container.innerHTML = '<div id="no-references" class="text-center" style="padding: 20px; color: #666;">No reference information available</div>';
                }
            } else {
                container.innerHTML = '<div id="no-references" class="text-center" style="padding: 20px; color: #666;">No reference information available</div>';
            }
        }
        
        // 格式化值，空值显示为 "/"
        function formatValue(value) {
            return (value && value.toString().trim()) ? value.toString().trim() : '/';
        }
        
        // 下载FASTA文件
        function downloadFasta(plzId, enzymeName, hostOrganism, sequence) {
            const header = `>${plzId}|${enzymeName}|${hostOrganism}`;
            const formattedSequence = sequence.replace(/(.{80})/g, '$1\n');
            const fastaContent = `${header}\n${formattedSequence}`;
            
            const blob = new Blob([fastaContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${plzId}.fasta`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // 导出选中项
        function exportSelected() {
            if (selectedItems.length === 0) {
                alert('Please select items to export first');
                return;
            }
            
            // 获取选中的数据 - 使用PLZ_ID而不是id
            const selectedData = currentResults.filter(item => selectedItems.includes(item.PLZ_ID));
            
            if (selectedData.length === 0) {
                alert('No valid data to export');
                return;
            }
            
            // 导出为CSV
            exportToCSV(selectedData, `PlaszymeDB_Selected_${selectedData.length}_items.csv`);
        }
        
        // 导出全部
        function exportAll() {
            if (currentResults.length === 0) {
                alert('No data available to export');
                return;
            }
            
            // 导出所有当前结果
            exportToCSV(currentResults, `PlaszymeDB_All_${currentResults.length}_items.csv`);
        }
        
        // 通用CSV导出函数
        function exportToCSV(data, filename) {
            // 定义CSV列标题 - 基于真实的数据库字段
            const headers = [
                'PLZ_ID',
                'Protein_ID',
                'Enzyme Name',
                'EC Number',
                'Predicted EC Number',
                'Gene Name',
                'Host Organism',
                'Taxonomy',
                'Plastic Type',
                'GenBank IDs',
                'UniProt IDs',
                'PDB IDs',
                'RefSeq IDs',
                'Reference',
                'Source Name',
                'Sequence Source',
                'Structure Source',
                'EC Number Source',
                'EC Prediction Source',
                'Sequence'
            ];
            
            // 构建CSV内容
            let csvContent = headers.join(',') + '\n';
            
            data.forEach(item => {
                const row = [
                    escapeCSV(item.PLZ_ID || ''),
                    escapeCSV(item.protein_id || ''),
                    escapeCSV(item.enzyme_name || ''),
                    escapeCSV(item.ec_number || ''),
                    escapeCSV(item.predicted_ec_number || ''),
                    escapeCSV(item.gene_name || ''),
                    escapeCSV(item.host_organism || ''),
                    escapeCSV(item.taxonomy || ''),
                    escapeCSV(item.plastic || ''),
                    escapeCSV(item.genbank_ids || ''),
                    escapeCSV(item.uniprot_ids || ''),
                    escapeCSV(item.pdb_ids || ''),
                    escapeCSV(item.refseq_ids || ''),
                    escapeCSV(item.reference || ''),
                    escapeCSV(item.source_name || ''),
                    escapeCSV(item.sequence_source || ''),
                    escapeCSV(item.structure_source || ''),
                    escapeCSV(item.ec_number_source || ''),
                    escapeCSV(item.ec_prediction_source || ''),
                    escapeCSV(item.sequence || '')
                ];
                csvContent += row.join(',') + '\n';
            });
            
            // 创建Blob并下载
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // 显示成功消息
            showNotification(`Successfully exported ${data.length} items to ${filename}`, 'success');
        }
        
        // CSV字段转义函数
        function escapeCSV(field) {
            if (field === null || field === undefined) {
                return '';
            }
            
            // 转换为字符串
            let str = String(field);
            
            // 如果包含逗号、引号或换行符，需要用引号包裹并转义内部引号
            if (str.includes(',') || str.includes('"') || str.includes('\n') || str.includes('\r')) {
                str = '"' + str.replace(/"/g, '""') + '"';
            }
            
            return str;
        }
        
        // 显示通知消息
        function showNotification(message, type = 'info') {
            // 创建通知元素
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            // 添加样式
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                border-radius: 4px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
                font-size: 14px;
                max-width: 400px;
            `;
            
            // 添加到页面
            document.body.appendChild(notification);
            
            // 3秒后自动移除
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // 搜索框回车事件
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('browse-search-input');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }
        });
        
        // 页面加载完成时初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 自动加载首页统计信息
            loadDatabaseStats();
            
            // 控制按钮交互
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.style.background = '#005eb8';
                    this.style.color = 'white';
                    setTimeout(() => {
                        this.style.background = '#f8f9fa';
                        this.style.color = '#666';
                    }, 200);
                });
            });
            
            // 下载按钮功能
            const downloadBtn = document.querySelector('.download-btn');
            if (downloadBtn) {
                downloadBtn.addEventListener('click', function() {
                    alert('FASTA sequence download function');
                });
            }
            
            // 操作按钮功能
            document.querySelectorAll('.btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.textContent === 'Back to List') {
                        showPage('browse');
                    } else if (this.textContent === 'Add to Compare') {
                        // 执行对比功能：跳转到BLAST页面并自动搜索
                        compareWithBlast();
                    }
                });
            });
        });
        
        // 全局变量：3D结构查看器实例
        let protein3DViewer = null;
        
        // 全局变量：当前酶的信息
        let currentEnzymeData = null;
        
        // 对比功能：使用当前酶序列进行BLAST搜索
        function compareWithBlast() {
            console.log('compareWithBlast 被调用');
            console.log('currentEnzymeData:', currentEnzymeData);
            
            if (!currentEnzymeData) {
                alert('Unable to retrieve current enzyme sequence information, please reload the page');
                return;
            }
            
            // 检查是否有序列信息（数据库字段名是sequence，不是protein_sequence）
            const sequence = currentEnzymeData.sequence || currentEnzymeData.protein_sequence;
            console.log('提取的序列:', sequence);
            
            if (!sequence || sequence.trim() === '' || sequence === '/') {
                console.log('Sequence check failed, available fields:', Object.keys(currentEnzymeData));
                alert('No protein sequence information available for current enzyme');
                return;
            }
            
            console.log('跳转到BLAST页面');
            // 跳转到BLAST页面
            showPage('blast');
            
            // 等待页面渲染完成后填入序列并开始搜索
            setTimeout(() => {
                const sequenceInput = document.getElementById('blastSequenceInput');
                if (sequenceInput) {
                    // 将序列格式化为FASTA格式
                    const fastaSequence = `>${currentEnzymeData.PLZ_ID || 'Unknown'} - ${currentEnzymeData.enzyme_name || 'Unknown Enzyme'}\n${sequence}`;
                    console.log('设置FASTA序列:', fastaSequence);
                    sequenceInput.value = fastaSequence;
                    
                    // 自动开始BLAST搜索
                    console.log('开始执行BLAST搜索');
                    performBlastSearch();
                } else {
                    console.error('Unable to find BLAST sequence input box');
                    alert('Page loading error, please manually input sequence to search');
                }
            }, 300);
        }
        
        // 初始化蛋白质3D结构查看器
        async function initProtein3DViewer(plzId) {
            try {
                console.log(`初始化3D结构查看器: ${plzId}`);
                
                // 如果已有查看器实例，先销毁
                if (protein3DViewer) {
                    protein3DViewer.destroy();
                    protein3DViewer = null;
                }
                
                // 创建新的查看器实例
                protein3DViewer = new OptimizedProteinViewer('protein-3d-viewer', {
                    onLoadStart: (plzId, dataType) => {
                        console.log(`开始加载结构: ${plzId} (${dataType})`);
                    },
                    onLoadComplete: (plzId, dataType, data) => {
                        console.log(`结构加载完成: ${plzId} (${dataType})`);
                    },
                    onLoadError: (plzId, dataType, error) => {
                        console.error(`Structure loading failed: ${plzId} (${dataType})`, error);
                    },
                    onInit: (viewer) => {
                        console.log('3D结构查看器初始化完成');
                        // 查看器初始化完成后，自动加载结构
                        if (plzId) {
                            setTimeout(() => {
                                loadProteinStructure(plzId);
                            }, 1000);
                        }
                    }
                });
                
            } catch (error) {
                console.error('Failed to initialize 3D structure viewer:', error);
            }
        }
        
        // 加载蛋白质结构
        async function loadProteinStructure(plzId, dataType = 'predicted') {
            if (!protein3DViewer) {
                console.error('3D structure viewer not initialized');
                return;
            }
            
            try {
                await protein3DViewer.loadStructure(plzId, dataType);
            } catch (error) {
                console.error('Failed to load protein structure:', error);
            }
        }
        
        // 测试3D结构加载功能
        function testStructureLoad(plzId = '00d4a4bfbe') {
            console.log(`测试加载结构: ${plzId}`);
            if (protein3DViewer) {
                loadProteinStructure(plzId);
            } else {
                console.log('3D结构查看器未初始化，尝试初始化...');
                initProtein3DViewer(plzId);
            }
        }
        
        // 显示详情页面并加载3D结构
        function showDetailWithStructure(plzId, enzymeData = null) {
            console.log(`显示详情页面并加载3D结构: ${plzId}`);
            
            if (enzymeData) {
                // 如果提供了酶数据，直接显示
                showPage('detail');
                populateDetailPage(enzymeData, plzId);
            } else {
                // 否则调用原来的showDetail函数
                showDetail(plzId);
            }
        }
        
        // ================== 首页搜索功能 ==================
        
        // 执行首页搜索
        function performHomeSearch() {
            const query = document.getElementById('home-search-input').value.trim();
            if (!query) {
                alert('Please enter search content');
                return;
            }
            
            // 检测是否为蛋白质序列（长度超过20个字符且包含大量氨基酸字母）
            const proteinPattern = /^[ACDEFGHIKLMNPQRSTVWY\s>]+$/i;
            const isProteinSequence = query.length > 20 && proteinPattern.test(query.replace(/\s/g, ''));
            
            if (isProteinSequence) {
                // 如果是蛋白质序列，跳转到BLAST页面
                showPage('blast');
                document.getElementById('blastSequenceInput').value = query;
            } else {
                // 否则跳转到BROWSE页面进行常规搜索
                showPage('browse');
                document.getElementById('browse-search-input').value = query;
                // 稍后自动执行搜索
                setTimeout(() => {
                    performSearch();
                }, 200);
            }
        }
        
        // 首页搜索框回车事件
        document.addEventListener('DOMContentLoaded', function() {
            const homeSearchInput = document.getElementById('home-search-input');
            if (homeSearchInput) {
                homeSearchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performHomeSearch();
                    }
                });
            }
        });
        
        // ================== BLAST 功能 ==================
        
        // BLAST示例序列
        const blastExampleSequence = `>PETase_example
MNFPRASRLMQAAVLGGLMAVSAAATAQTNPYARGPNPTAASLEASAGPFTVRSFTVSRPSGYGAGTVYYPTNAGGTVGAIAIVPGYTARQSSIKWWGPRLASHGFVVITIDTNSTLDQPSSRSSQQMAALRQVASLNGTSSSPIYGKVDTARMGVMGWSMGGGGSLISAANNPSLKAAAPQAPWDSSTNFSSVTVPTLIFACENDSIAPVNSSALPIYDSMSRNAKQFLEINGGSHSCANSGNSNQALIGKKGVAWMKRFMDNDTRYSTFACENPNSTRVSDFRTANCSLEDYYFMKESL`;
        
        // 加载BLAST示例序列
        function loadBlastExample() {
            document.getElementById('blastSequenceInput').value = blastExampleSequence;
        }
        
        // 重置BLAST表单
        function resetBlastForm() {
            document.getElementById('blastSequenceInput').value = '';
            document.getElementById('blastMaxResults').value = '25';
            document.getElementById('blastThreshold').value = 'medium';
            document.getElementById('blastPlasticFilter').value = 'all';
            document.getElementById('blastStructureFilter').value = 'all';
            document.getElementById('blastResultsContainer').style.display = 'none';
        }
        
        // BLAST搜索
        async function performBlastSearch() {
            const sequence = document.getElementById('blastSequenceInput').value.trim();
            if (!sequence) {
                alert('Please enter protein sequence');
                return;
            }
            
            // 保存查询序列（清理FASTA头部）
            currentBlastQuery = cleanSequenceForExport(sequence);
            
            // 显示加载状态
            showBlastLoading(true);
            
            try {
                const response = await fetch('blast_search.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        sequence: sequence,
                        max_results: parseInt(document.getElementById('blastMaxResults').value),
                        threshold: document.getElementById('blastThreshold').value,
                        plastic_filter: document.getElementById('blastPlasticFilter').value,
                        structure_filter: document.getElementById('blastStructureFilter').value
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayBlastResults(data);
                } else {
                    alert('Search failed: ' + (data.error || 'Unknown error'));
                }
                
            } catch (error) {
                console.error('BLAST search error:', error);
                alert('Network error, please check connection and try again');
            } finally {
                showBlastLoading(false);
            }
        }
        
        // 清理序列用于导出（移除FASTA头部）
        function cleanSequenceForExport(sequence) {
            const lines = sequence.split('\n');
            const cleanLines = [];
            
            for (let line of lines) {
                line = line.trim();
                if (line && !line.startsWith('>')) {
                    cleanLines.push(line);
                }
            }
            
            return cleanLines.join('').replace(/\s+/g, '').toUpperCase();
        }
        
        // 显示/隐藏BLAST加载状态
        function showBlastLoading(show) {
            const loadingContainer = document.getElementById('blastLoadingContainer');
            const submitBtn = document.getElementById('blastSubmitBtn');
            const searchForm = document.querySelector('.blast-search-form');
            
            if (show) {
                loadingContainer.style.display = 'block';
                submitBtn.disabled = true;
                submitBtn.textContent = '🔍 Searching...';
                searchForm.style.display = 'none';
            } else {
                loadingContainer.style.display = 'none';
                submitBtn.disabled = false;
                submitBtn.textContent = '🔍 Search Similar Sequences';
                searchForm.style.display = 'block';
            }
        }
        
        // 显示BLAST结果
        function displayBlastResults(data) {
            const resultsContainer = document.getElementById('blastResultsContainer');
            const resultsInfo = document.getElementById('blastResultsInfo');
            const tableBody = document.getElementById('blastResultsTableBody');
            
            // 保存结果数据用于导出
            currentBlastResults = data.results || [];
            
            // 更新结果信息
            resultsInfo.textContent = `Found ${data.total_found} similar sequences (Query length: ${data.query_length} aa, Search time: ${data.search_time?.toFixed(2)}s)`;
            
            // 清空表格
            tableBody.innerHTML = '';
            
            if (data.results.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 2rem; color: #666;">
                            No matching results found
                        </td>
                    </tr>
                `;
            } else {
                // 添加结果行
                data.results.forEach((result, index) => {
                    const row = createBlastResultRow(result, index + 1);
                    tableBody.appendChild(row);
                });
            }
            
            // 显示结果容器
            resultsContainer.style.display = 'block';
            
            // 滚动到结果区域
            resultsContainer.scrollIntoView({
                behavior: 'smooth'
            });
        }
        
        // 创建BLAST结果行
        function createBlastResultRow(result, rank) {
            const row = document.createElement('tr');
            row.className = 'blast-result-row';
            
            // 确定相同度等级
            const identityClass = result.identity >= 70 ? 'blast-score-excellent' : 
                                 result.identity >= 50 ? 'blast-score-good' : 'blast-score-fair';
            
            // 获取塑料类型的颜色
            const plasticColor = getPlasticColor(result.plastic);
            
            // 格式化比对预览
            let alignmentPreview = '';
            if (result.alignment_preview) {
                const preview = result.alignment_preview;
                alignmentPreview = `
                    <div class="blast-alignment-preview">
                        Query: ${preview.query}<br>
                        Match: ${preview.match}<br>
                        Subj:  ${preview.subject}
                    </div>
                `;
            }
            
            row.innerHTML = `
                <td><strong>${rank}</strong></td>
                <td>
                    <a href="#" class="blast-enzyme-link" onclick="showDetail('${result.plz_id}')">
                        ${result.plz_id} - ${result.enzyme_name || 'Unknown'}
                    </a>
                </td>
                <td class="blast-organism-name">${result.host_organism || 'N/A'}</td>
                <td>
                    <span class="plastic-tag" style="background: ${plasticColor.bg}; color: ${plasticColor.text};">
                        ${result.plastic || 'N/A'}
                    </span>
                </td>
                <td>
                    <span class="blast-score-badge ${identityClass}">${result.identity}%</span>
                </td>
                <td><strong>${result.score}</strong></td>
                <td>${result.coverage}%</td>
                <td>${alignmentPreview}</td>
                <td>
                    <button class="blast-view-btn" onclick="showDetail('${result.plz_id}')">
                        View
                    </button>
                </td>
            `;
            
            return row;
        }
        
        // 新BLAST搜索
        function newBlastSearch() {
            document.getElementById('blastResultsContainer').style.display = 'none';
            document.getElementById('blastSequenceInput').focus();
        }
        
        // 全局变量保存当前BLAST结果
        let currentBlastResults = null;
        let currentBlastQuery = null;
        
        // 导出BLAST结果
        function exportBlastResults(format) {
            if (!currentBlastResults || currentBlastResults.length === 0) {
                alert('No search results available to export');
                return;
            }
            
            try {
                if (format === 'fasta') {
                    exportToFasta();
                } else if (format === 'csv') {
                    exportToCsv();
                } else {
                    alert('Unsupported export format');
                }
            } catch (error) {
                console.error('Export failed:', error);
                alert('Export failed: ' + error.message);
            }
        }
        
        // 导出为FASTA格式
        function exportToFasta() {
            let fastaContent = '';
            
            // 添加查询序列
            if (currentBlastQuery) {
                fastaContent += `>Query_Sequence | Length: ${currentBlastQuery.length} aa\n`;
                fastaContent += formatSequenceLines(currentBlastQuery) + '\n\n';
            }
            
            // 添加匹配的序列
            fastaContent += `# BLAST Search Results\n`;
            fastaContent += `# Total Matches: ${currentBlastResults.length}\n`;
            fastaContent += `# Generated: ${new Date().toISOString()}\n\n`;
            
            currentBlastResults.forEach((result, index) => {
                const header = `>${result.plz_id} | ${result.enzyme_name || 'Unknown'} | ${result.host_organism || 'N/A'} | Identity: ${result.identity}% | Coverage: ${result.coverage}% | Score: ${result.score}`;
                fastaContent += header + '\n';
                
                // 这里我们需要从数据库获取完整序列
                // 由于结果中可能没有完整序列，我们添加一个占位符说明
                fastaContent += `# Note: To view the complete sequence, please access the enzyme details page\n`;
                fastaContent += `# PLZ_ID: ${result.plz_id}\n\n`;
            });
            
            // 创建下载
            downloadFile(fastaContent, `blast_results_${getTimestamp()}.fasta`, 'text/plain');
        }
        
        // 导出为CSV格式
        function exportToCsv() {
            let csvContent = '';
            
            // CSV 表头
            const headers = [
                'Rank',
                'PLZ_ID',
                'Enzyme Name',
                'Host Organism',
                'Plastic Type',
                'EC Number',
                'PDB ID',
                'Identity (%)',
                'Coverage (%)',
                'Score',
                'Alignment Preview'
            ];
            csvContent += headers.map(h => `"${h}"`).join(',') + '\n';
            
            // 添加数据行
            currentBlastResults.forEach((result, index) => {
                const row = [
                    index + 1,
                    result.plz_id || '',
                    result.enzyme_name || 'Unknown',
                    result.host_organism || 'N/A',
                    result.plastic || 'N/A',
                    result.ec_number || 'N/A',
                    result.pdb_id || 'N/A',
                    result.identity,
                    result.coverage,
                    result.score,
                    formatAlignmentForCsv(result.alignment_preview)
                ];
                csvContent += row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',') + '\n';
            });
            
            // 添加元数据
            csvContent += '\n# Metadata\n';
            csvContent += `"Export Date","${new Date().toISOString()}"\n`;
            csvContent += `"Total Results","${currentBlastResults.length}"\n`;
            if (currentBlastQuery) {
                csvContent += `"Query Length","${currentBlastQuery.length} aa"\n`;
            }
            
            // 创建下载
            downloadFile(csvContent, `blast_results_${getTimestamp()}.csv`, 'text/csv');
        }
        
        // 格式化序列为多行（每行60个字符）
        function formatSequenceLines(sequence, lineLength = 60) {
            const lines = [];
            for (let i = 0; i < sequence.length; i += lineLength) {
                lines.push(sequence.substring(i, i + lineLength));
            }
            return lines.join('\n');
        }
        
        // 格式化比对信息为CSV格式
        function formatAlignmentForCsv(alignment) {
            if (!alignment) return 'N/A';
            
            if (typeof alignment === 'object') {
                return `Query: ${alignment.query || ''} | Match: ${alignment.match || ''} | Subject: ${alignment.subject || ''}`;
            }
            return String(alignment);
        }
        
        // 生成时间戳字符串
        function getTimestamp() {
            const now = new Date();
            return now.toISOString().replace(/[:.]/g, '-').substring(0, 19);
        }
        
        // 下载文件
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
        
        // BLAST表单提交处理
        document.addEventListener('DOMContentLoaded', function() {
            const blastForm = document.getElementById('blastSearchForm');
            if (blastForm) {
                blastForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    performBlastSearch();
                });
            }
            
            // BLAST序列输入框回车事件
            const blastInput = document.getElementById('blastSequenceInput');
            if (blastInput) {
                blastInput.addEventListener('keydown', function(e) {
                    if (e.ctrlKey && e.key === 'Enter') {
                        e.preventDefault();
                        performBlastSearch();
                    }
                });
            }
        });

        // iTOL iframe 管理函数
        function openTree(treeType) {
            // 根据树类型确定URL
            let itolUrl;
            switch(treeType) {
                case 'comprehensive':
                    itolUrl = 'https://itol.embl.de/shared/mtfbwy';
                    break;
                case 'pet':
                    itolUrl = 'https://itol.embl.de/shared/mtfbwy';
                    break;
                case 'ec31':
                    itolUrl = 'https://itol.embl.de/shared/mtfbwy';
                    break;
                case 'pe_pp':
                    itolUrl = 'https://itol.embl.de/shared/mtfbwy';
                    break;
                case 'bacterial':
                    itolUrl = 'https://itol.embl.de/shared/mtfbwy';
                    break;
                case 'fungal':
                    itolUrl = 'https://itol.embl.de/shared/mtfbwy';
                    break;
                default:
                    itolUrl = 'https://itol.embl.de/shared/mtfbwy';
            }

            // 显示iframe容器
            const container = document.getElementById('itol-iframe-container');
            const iframe = document.getElementById('itol-iframe');
            
            if (container && iframe) {
                iframe.src = itolUrl;
                container.style.display = 'block';
                
                // 更新标题
                const title = document.querySelector('.iframe-title');
                if (title) {
                    title.textContent = `iTOL Phylogenetic Tree - ${getTreeName(treeType)}`;
                }
            }
        }

        function closeITOLFrame() {
            const container = document.getElementById('itol-iframe-container');
            const iframe = document.getElementById('itol-iframe');
            
            if (container && iframe) {
                container.style.display = 'none';
                iframe.src = ''; // 清空iframe源以停止加载
            }
        }

        function getTreeName(treeType) {
            const treeNames = {
                'comprehensive': 'Comprehensive Enzyme Tree',
                'pet': 'PET Degradation Enzymes',
                'ec31': 'EC 3.1 Esterases',
                'pe_pp': 'PE/PP Degrading Enzymes',
                'bacterial': 'Bacterial Enzymes',
                'fungal': 'Fungal Enzymes'
            };
            return treeNames[treeType] || 'PlaszymeDB Phylogeny';
        }

        // 点击容器外部关闭iframe
        document.addEventListener('click', function(event) {
            const container = document.getElementById('itol-iframe-container');
            if (container && container.style.display === 'block') {
                const iframe = container.querySelector('.iframe-content');
                const header = container.querySelector('.iframe-header');
                const footer = container.querySelector('.iframe-footer');
                
                // 如果点击的是容器外部，关闭iframe
                if (!container.contains(event.target)) {
                    closeITOLFrame();
                }
            }
        });

        // ESC键关闭iframe
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const container = document.getElementById('itol-iframe-container');
                if (container && container.style.display === 'block') {
                    closeITOLFrame();
                }
            }
        });

        // 防止 iTOL iframe 内的滚动事件冒泡到父页面
        function preventIframeScrollBubbling() {
            const iframeContainer = document.querySelector('.itol-embedded-content');
            const phylogenyIframe = document.getElementById('phylogeny-iframe');
            
            if (iframeContainer) {
                // 阻止容器的滚动事件冒泡
                iframeContainer.addEventListener('wheel', function(event) {
                    event.stopPropagation();
                    event.preventDefault();
                }, { passive: false });

                // 阻止容器的触摸滚动事件冒泡（移动设备）
                iframeContainer.addEventListener('touchmove', function(event) {
                    event.stopPropagation();
                }, { passive: false });

                // 鼠标进入iframe区域时，暂时禁用页面滚动
                iframeContainer.addEventListener('mouseenter', function() {
                    document.body.style.overflow = 'hidden';
                });

                // 鼠标离开iframe区域时，恢复页面滚动
                iframeContainer.addEventListener('mouseleave', function() {
                    document.body.style.overflow = 'auto';
                });
            }

            // 为 phylogeny iframe 添加额外的保护
            if (phylogenyIframe) {
                phylogenyIframe.addEventListener('load', function() {
                    console.log('iTOL iframe loaded, scroll protection activated');
                });
            }
        }


        // ============ 塑料化学结构查看器相关函数 ============
        
        let ketcherInstance = null;
        let currentPlasticSMILES = null;
        let currentPlasticTypes = [];
        
        /**
         * 初始化塑料化学结构查看器
         */
        async function initPlasticStructureViewer(enzyme) {
            try {
                // 获取塑料类型列表
                const plasticTypes = parsePlasticTypes(enzyme.plastic);
                currentPlasticTypes = plasticTypes;
                
                if (plasticTypes.length === 0) {
                    showPlasticStructureError('This enzyme has no marked degradable plastic types');
                    return;
                }
                
                // 更新副标题
                document.getElementById('plastic-structure-subtitle').textContent = 
                    `This enzyme can degrade ${plasticTypes.length} plastic type(s)`;
                
                // 如果有多个塑料类型，显示选择器
                if (plasticTypes.length > 1) {
                    populatePlasticSelector(plasticTypes);
                    document.getElementById('plastic-selector-container').style.display = 'block';
                }
                
                // 加载第一个塑料的结构
                await loadPlasticStructure(plasticTypes[0]);
                
            } catch (error) {
                console.error('Failed to initialize plastic chemical structure viewer:', error);
                showPlasticStructureError('Initialization failed: ' + error.message);
            }
        }
        
        /**
         * 解析塑料类型字符串
         */
        function parsePlasticTypes(plasticString) {
            if (!plasticString || plasticString === '/' || plasticString === 'N/A') {
                return [];
            }
            
            // 分割并清理塑料类型
            return plasticString.split(',')
                .map(p => p.trim())
                .filter(p => p && p !== '/' && p !== 'N/A');
        }
        
        /**
         * 填充塑料选择器
         */
        function populatePlasticSelector(plasticTypes) {
            const select = document.getElementById('plastic-type-select');
            select.innerHTML = '<option value="">-- Please Select --</option>';
            
            plasticTypes.forEach(plastic => {
                const option = document.createElement('option');
                option.value = plastic;
                option.textContent = plastic;
                select.appendChild(option);
            });
            
            // 默认选中第一个
            if (plasticTypes.length > 0) {
                select.value = plasticTypes[0];
            }
        }
        
        /**
         * 初始化化学结构查看器（使用简化的显示方式）
         */
        async function initKetcher() {
            try {
                const container = document.getElementById('ketcher-container');
                // 初始化容器，准备显示化学结构
                container.innerHTML = '<div id="structure-display" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border-radius: 8px;"><p style="color: #999;">Waiting to load chemical structure...</p></div>';
                ketcherInstance = true; // 标记为已初始化
                console.log('Chemical structure viewer initialized successfully');
            } catch (error) {
                console.error('Failed to initialize chemical structure viewer:', error);
                throw error;
            }
        }
        
        /**
         * 加载塑料化学结构
         */
        async function loadPlasticStructure(plasticType) {
            if (!plasticType) return;
            
            try {
                // 显示加载状态
                document.getElementById('plastic-structure-loading').style.display = 'block';
                document.getElementById('plastic-structure-error').style.display = 'none';
                document.getElementById('ketcher-container').style.display = 'none';
                document.getElementById('plastic-structure-info').style.display = 'none';
                
                // 获取SMILES数据
                const response = await fetch(`get_plastic_smiles.php?plastic=${encodeURIComponent(plasticType)}`);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Failed to retrieve SMILES data');
                }
                
                const plasticData = data.data;
                
                // 检查是否为混合物
                if (!plasticData.smiles) {
                    showPlasticStructureError(`${plasticData.name} is a mixture: ${plasticData.note}`);
                    return;
                }
                
                currentPlasticSMILES = plasticData.smiles;
                
                // 更新副标题
                document.getElementById('plastic-structure-subtitle').textContent = 
                    `Molecular structure of ${plasticData.name}`;
                
                // 隐藏加载状态，显示查看器
                document.getElementById('plastic-structure-loading').style.display = 'none';
                document.getElementById('ketcher-container').style.display = 'block';
                document.getElementById('plastic-structure-info').style.display = 'block';
                
                // 显示SMILES信息
                document.getElementById('plastic-smiles-text').textContent = plasticData.smiles;
                
                // 使用图像方式显示化学结构
                displayStructureAsImage(plasticData.smiles);
                
            } catch (error) {
                console.error('Failed to load plastic chemical structure:', error);
                showPlasticStructureError(error.message);
            }
        }
        
        /**
         * 使用图像显示化学结构（不使用 iframe 以避免跨域问题）
         */
        function displayStructureAsImage(smiles) {
            const container = document.getElementById('ketcher-container');
            const encodedSMILES = encodeURIComponent(smiles);
            
            // 使用 NCI CADD 服务（经测试可用）
            const nciImageUrl = `https://cactus.nci.nih.gov/chemical/structure/${encodedSMILES}/image`;
            
            console.log('开始加载化学结构图像...');
            console.log('SMILES:', smiles);
            console.log('NCI CADD URL:', nciImageUrl);
            
            // 直接使用 img 标签，不使用 iframe，避免跨域安全问题
            container.innerHTML = `
                <div style="width: 100%; height: 100%; min-height: 520px; display: flex; flex-direction: column; background: white; position: relative;">
                    <div style="flex: 1; display: flex; align-items: center; justify-content: center; width: 100%; position: relative; padding: 1rem;">
                        <div id="image-loading" style="position: absolute; color: #999; font-size: 1rem;">⏳ Loading chemical structure...</div>
                        <img id="structure-image" 
                             src="${nciImageUrl}" 
                             alt="Chemical structure" 
                             style="width: 100%; height: 100%; object-fit: contain; display: none;"
                             onerror="handleImageError(this)"
                             onload="handleImageLoad(this)">
                    </div>
                    <p style="position: absolute; bottom: 8px; right: 12px; color: #999; font-size: 0.7rem; margin: 0; background: rgba(255,255,255,0.9); padding: 4px 8px; border-radius: 4px;">
                        Chemical structure generated by NCI CADD
                    </p>
                </div>
            `;
        }
        
        /**
         * 处理图像加载成功
         */
        function handleImageLoad(img) {
            console.log('Chemical structure image loaded successfully');
            const loadingDiv = document.getElementById('image-loading');
            if (loadingDiv) loadingDiv.style.display = 'none';
            img.style.display = 'block';
        }
        
        /**
         * 处理图像加载失败
         */
        function handleImageError(img) {
            console.error('Failed to load NCI CADD chemical structure image');
            const loadingDiv = document.getElementById('image-loading');
            
            if (loadingDiv) {
                loadingDiv.innerHTML = '❌ Failed to load chemical structure image<br><small style="font-size: 0.85em;">Please check network connection or try again later</small>';
                loadingDiv.style.color = '#d32f2f';
                loadingDiv.style.fontSize = '1rem';
            }
            img.style.display = 'none';
        }
        
        /**
         * 显示塑料化学结构错误
         */
        function showPlasticStructureError(message) {
            document.getElementById('plastic-structure-loading').style.display = 'none';
            document.getElementById('ketcher-container').style.display = 'none';
            document.getElementById('plastic-structure-info').style.display = 'none';
            document.getElementById('plastic-structure-error').style.display = 'block';
            document.getElementById('plastic-structure-error-msg').textContent = message;
        }
        
        // ============ 塑料化学结构查看器函数结束 ============

        // 页面加载完成后初始化滚动保护
        document.addEventListener('DOMContentLoaded', function() {
            preventIframeScrollBubbling();
        });
        
    </script>
</body>
</html>