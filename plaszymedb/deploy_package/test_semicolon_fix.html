<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•åˆ†å·ä¿®å¤ - PLZ_ID URL ç¼–ç </title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
        }
        h2 {
            color: #34495e;
            margin-top: 0;
        }
        .test-case {
            background: #ecf0f1;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #2980b9;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ PLZ_ID åˆ†å·ç¼–ç ä¿®å¤æµ‹è¯•</h1>
    
    <div class="info">
        <strong>é—®é¢˜æè¿°ï¼š</strong> æ•°æ®åº“ä¸­æŸäº› PLZ_ID åŒ…å«åˆ†å·ï¼ˆå¦‚ <code>98b7748823;e79726b180</code>ï¼‰ï¼Œ
        åœ¨ URL ä¸­éœ€è¦æ­£ç¡®ç¼–ç ä¸º <code>%3B</code>ï¼Œå¦åˆ™ä¼šè¢«æˆªæ–­ã€‚
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•ç”¨ä¾‹</h2>
        
        <div class="test-case">
            <h3>1. X0002 - å¸¦åˆ†å·çš„ PLZ_ID</h3>
            <p><strong>PLZ_ID:</strong> <code>98b7748823;e79726b180</code></p>
            <button onclick="testApi('98b7748823;e79726b180', 'test1')">æµ‹è¯• API (info)</button>
            <button onclick="testPdbLoad('98b7748823;e79726b180', 'test1')">æµ‹è¯• PDB åŠ è½½</button>
            <div id="test1" class="result" style="display:none;"></div>
        </div>

        <div class="test-case">
            <h3>2. X0003 - å¸¦åˆ†å·çš„ PLZ_ID</h3>
            <p><strong>PLZ_ID:</strong> <code>60ea077c8e;8992bea4a0</code></p>
            <button onclick="testApi('60ea077c8e;8992bea4a0', 'test2')">æµ‹è¯• API (info)</button>
            <button onclick="testPdbLoad('60ea077c8e;8992bea4a0', 'test2')">æµ‹è¯• PDB åŠ è½½</button>
            <div id="test2" class="result" style="display:none;"></div>
        </div>

        <div class="test-case">
            <h3>3. X0009 - å¤šä¸ªåˆ†å·çš„ PLZ_ID</h3>
            <p><strong>PLZ_ID:</strong> <code>bb22e38599;75d1d6dced;788e7e51f7</code></p>
            <button onclick="testApi('bb22e38599;75d1d6dced;788e7e51f7', 'test3')">æµ‹è¯• API (info)</button>
            <button onclick="testPdbLoad('bb22e38599;75d1d6dced;788e7e51f7', 'test3')">æµ‹è¯• PDB åŠ è½½</button>
            <div id="test3" class="result" style="display:none;"></div>
        </div>

        <div class="test-case">
            <h3>4. X0001 - ä¸å¸¦åˆ†å·çš„ PLZ_ID (å¯¹ç…§ç»„)</h3>
            <p><strong>PLZ_ID:</strong> <code>866554aa77</code></p>
            <button onclick="testApi('866554aa77', 'test4')">æµ‹è¯• API (info)</button>
            <button onclick="testPdbLoad('866554aa77', 'test4')">æµ‹è¯• PDB åŠ è½½</button>
            <div id="test4" class="result" style="display:none;"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>URL ç¼–ç å¯¹æ¯”</h2>
        <div id="encoding-demo"></div>
    </div>

    <script>
        // æ˜¾ç¤ºç¼–ç å¯¹æ¯”
        function showEncodingDemo() {
            const testIds = [
                '98b7748823;e79726b180',
                '60ea077c8e;8992bea4a0',
                'bb22e38599;75d1d6dced;788e7e51f7',
                '866554aa77'
            ];
            
            let html = '<table style="width:100%; border-collapse: collapse;">';
            html += '<tr style="background: #34495e; color: white;"><th style="padding:10px; text-align:left;">åŸå§‹ PLZ_ID</th><th style="padding:10px; text-align:left;">ç¼–ç å</th></tr>';
            
            testIds.forEach((id, i) => {
                const encoded = encodeURIComponent(id);
                const bg = i % 2 === 0 ? '#ecf0f1' : 'white';
                html += `<tr style="background: ${bg};">
                    <td style="padding:10px; font-family: monospace;">${id}</td>
                    <td style="padding:10px; font-family: monospace; color: #27ae60;">${encoded}</td>
                </tr>`;
            });
            
            html += '</table>';
            document.getElementById('encoding-demo').innerHTML = html;
        }

        // æµ‹è¯• API info ç«¯ç‚¹
        async function testApi(plzId, resultId) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'æµ‹è¯•ä¸­...';
            
            try {
                // ä½¿ç”¨ encodeURIComponent ç¼–ç  PLZ_ID
                const encodedId = encodeURIComponent(plzId);
                const url = `api_protein_structure.php?plz_id=${encodedId}&type=predicted&action=info`;
                
                resultDiv.textContent = `è¯·æ±‚ URL:\n${url}\n\næ­£åœ¨åŠ è½½...`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.error) {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ å¤±è´¥\n\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… æˆåŠŸ!\n\nPLZ_ID: ${data.plz_id}\nXID: ${data.xid}\nPDB å­˜åœ¨: ${data.files?.pdb_exists}\nJSON å­˜åœ¨: ${data.files?.json_exists}\n\nå®Œæ•´å“åº”:\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // æµ‹è¯• PDB æ–‡ä»¶åŠ è½½
        async function testPdbLoad(plzId, resultId) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'åŠ è½½ PDB æ–‡ä»¶...';
            
            try {
                // ä½¿ç”¨ encodeURIComponent ç¼–ç  PLZ_ID
                const encodedId = encodeURIComponent(plzId);
                const url = `api_protein_structure.php?plz_id=${encodedId}&type=predicted&action=pdb`;
                
                resultDiv.textContent = `è¯·æ±‚ URL:\n${url}\n\næ­£åœ¨åŠ è½½...`;
                
                const response = await fetch(url);
                const text = await response.text();
                
                if (response.ok && text.startsWith('HEADER')) {
                    // æˆåŠŸåŠ è½½ PDB
                    const lines = text.split('\n');
                    const preview = lines.slice(0, 10).join('\n');
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… PDB æ–‡ä»¶åŠ è½½æˆåŠŸ!\n\næ–‡ä»¶å¤§å°: ${text.length} å­—èŠ‚\næ€»è¡Œæ•°: ${lines.length}\n\nå‰10è¡Œ:\n${preview}`;
                } else {
                    // å°è¯•è§£æä¸º JSONï¼ˆå¯èƒ½æ˜¯é”™è¯¯æ¶ˆæ¯ï¼‰
                    try {
                        const error = JSON.parse(text);
                        resultDiv.className = 'result error';
                        resultDiv.textContent = `âŒ å¤±è´¥\n\n${JSON.stringify(error, null, 2)}`;
                    } catch {
                        resultDiv.className = 'result error';
                        resultDiv.textContent = `âŒ å¤±è´¥\n\nHTTP ${response.status}\n\n${text.substring(0, 500)}`;
                    }
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºç¼–ç å¯¹æ¯”
        showEncodingDemo();
    </script>
</body>
</html>

